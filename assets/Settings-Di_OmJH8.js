import{r as n,j as e,S as M}from"./index-Dae3Oafu.js";import{l as A,u as C}from"./settingsService-BfV9uKhR.js";const D=()=>{var N;const[r,v]=n.useState(null),[k,p]=n.useState(!0),[l,m]=n.useState({schoolLatitude:0,schoolLongitude:0,maxDistanceMeters:200,academicYears:[],timezone:"Asia/Jakarta",jpDurationMinutes:35,schoolDays:6}),[f,x]=n.useState(""),[d,j]=n.useState(""),[b,g]=n.useState(!1),[u,h]=n.useState(null);n.useEffect(()=>{p(!0);const a=A(s=>{s&&v(s),p(!1)});return()=>a()},[]),n.useEffect(()=>{r&&(m(r),r.schoolLatitude&&r.schoolLongitude?x(`https://www.google.com/maps/@${r.schoolLatitude},${r.schoolLongitude},17z`):x(""))},[r]);const w=a=>{const s=a.target.value;x(s);const c=/@(-?\d+\.\d+),(-?\d+\.\d+)/,t=s.match(c);t&&t[1]&&t[2]&&m(o=>({...o,schoolLatitude:parseFloat(t[1]),schoolLongitude:parseFloat(t[2])}))},i=a=>{const{name:s,value:c}=a.target,t=a.target.type==="number"||s==="schoolDays";m(o=>({...o,[s]:t?parseInt(c,10)||0:c}))},y=()=>{if(!/^\d{4}\/\d{4}$/.test(d)){alert("Format tahun ajaran tidak valid. Gunakan format YYYY/YYYY, contoh: 2024/2025.");return}const s=parseInt(d.split("/")[0]);if(parseInt(d.split("/")[1])!==s+1){alert("Tahun ajaran harus berurutan, contoh: 2024/2025.");return}m(t=>{const o=t.academicYears||[];if(o.includes(d))return alert("Tahun ajaran tersebut sudah ada."),t;const S=[...o,d].sort().reverse();return{...t,academicYears:S}}),j("")},T=a=>{window.confirm(`Yakin ingin menghapus tahun ajaran ${a}?`)&&m(s=>({...s,academicYears:(s.academicYears||[]).filter(c=>c!==a)}))},Y=async a=>{a.preventDefault(),g(!0),h(null);try{await C(l),h({message:"Pengaturan berhasil disimpan!",type:"success"})}catch(s){h({message:"Gagal menyimpan pengaturan.",type:"error"}),console.error(s)}finally{g(!1),setTimeout(()=>h(null),5e3)}};return k?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(M,{})}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Konfigurasi Aplikasi"}),e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Konfigurasi Absensi & Jadwal"}),e.jsx("div",{className:"divider",children:"Lokasi"}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tautan Google Maps"})}),e.jsx("input",{type:"url",placeholder:"Tempel tautan Google Maps di sini...",value:f,onChange:w,className:"input input-bordered w-full",required:!0}),e.jsx("div",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:'Buka Google Maps, cari lokasi, klik "Bagikan" lalu "Salin link".'})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Latitude (Otomatis)"})}),e.jsx("input",{type:"number",step:"any",value:l.schoolLatitude,className:"input input-bordered w-full bg-base-200 cursor-not-allowed",readOnly:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Longitude (Otomatis)"})}),e.jsx("input",{type:"number",step:"any",value:l.schoolLongitude,className:"input input-bordered w-full bg-base-200 cursor-not-allowed",readOnly:!0})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Radius Absensi (meter)"})}),e.jsx("input",{type:"number",name:"maxDistanceMeters",value:l.maxDistanceMeters??0,onChange:i,className:"input input-bordered w-full",required:!0})]}),e.jsx("div",{className:"divider",children:"Aturan Waktu Absensi"}),e.jsxs("div",{className:"p-4 border border-base-300 rounded-lg space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Untuk Guru GTY (Guru Tetap Yayasan)"}),e.jsx("p",{className:"text-sm text-base-content/70 mb-4",children:"Aturan ini hanya berlaku untuk guru dengan status GTY. Guru GTT tidak memiliki batasan waktu absensi."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Batas Jam Datang"})}),e.jsx("input",{type:"time",name:"gtyMaxCheckInTime",value:l.gtyMaxCheckInTime||"",onChange:i,className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Minimal Jam Pulang"})}),e.jsx("input",{type:"time",name:"gtyMinCheckOutTime",value:l.gtyMinCheckOutTime||"",onChange:i,className:"input input-bordered w-full"})]})]}),e.jsx("div",{className:"divider my-4"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Untuk Guru Piket"}),e.jsx("p",{className:"text-sm text-base-content/70 mb-4",children:"Aturan ini berlaku untuk semua guru (GTY/GTT) yang dijadwalkan piket pada hari tersebut."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Batas Jam Datang Guru Piket"})}),e.jsx("input",{type:"time",name:"piketMaxCheckInTime",value:l.piketMaxCheckInTime||"",onChange:i,className:"input input-bordered w-full"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Minimal Jam Pulang Guru Piket"})}),e.jsx("input",{type:"time",name:"piketMinCheckOutTime",value:l.piketMinCheckOutTime||"",onChange:i,className:"input input-bordered w-full"})]})]})]}),e.jsx("div",{className:"divider",children:"Aturan Jadwal Pelajaran"}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Durasi per Jam Pelajaran (menit)"})}),e.jsx("input",{type:"number",name:"jpDurationMinutes",value:l.jpDurationMinutes||"",onChange:i,className:"input input-bordered w-full",required:!0}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Digunakan untuk menghitung jam selesai otomatis saat membuat jadwal."})})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Pengaturan Umum"}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Zona Waktu Aplikasi"})}),e.jsxs("select",{name:"timezone",value:l.timezone,onChange:i,className:"select select-bordered w-full",children:[e.jsx("option",{value:"Asia/Jakarta",children:"WIB (Waktu Indonesia Barat - GMT+7)"}),e.jsx("option",{value:"Asia/Makassar",children:"WITA (Waktu Indonesia Tengah - GMT+8)"}),e.jsx("option",{value:"Asia/Jayapura",children:"WIT (Waktu Indonesia Timur - GMT+9)"})]}),e.jsx("div",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Semua waktu di aplikasi akan ditampilkan sesuai zona waktu ini."})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jumlah Hari Sekolah"})}),e.jsxs("select",{name:"schoolDays",value:l.schoolDays||6,onChange:i,className:"select select-bordered w-full",children:[e.jsx("option",{value:6,children:"6 Hari (Senin - Sabtu)"}),e.jsx("option",{value:5,children:"5 Hari (Senin - Jumat)"})]}),e.jsx("div",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Mengatur tampilan jadwal pelajaran mingguan."})})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Konfigurasi Tahun Ajaran"}),e.jsxs("div",{className:"form-control mt-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tambah Tahun Ajaran Baru"})}),e.jsxs("div",{className:"join",children:[e.jsx("input",{type:"text",placeholder:"Contoh: 2024/2025",className:"input input-bordered join-item w-full",value:d,onChange:a=>j(a.target.value)}),e.jsx("button",{type:"button",className:"btn btn-neutral join-item",onClick:y,children:"Tambah"})]})]}),e.jsx("div",{className:"overflow-x-auto mt-4",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tahun Ajaran Terdaftar"}),e.jsx("th",{className:"text-right",children:"Aksi"})]})}),e.jsxs("tbody",{children:[(N=l.academicYears)==null?void 0:N.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a}),e.jsx("td",{className:"text-right",children:e.jsx("button",{type:"button",className:"btn btn-error btn-sm",onClick:()=>T(a),children:"Hapus"})})]},a)),(!l.academicYears||l.academicYears.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center",children:"Belum ada tahun ajaran yang ditambahkan."})})]})]})})]})}),e.jsx("div",{className:"card-actions justify-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:b,children:b?e.jsx("span",{className:"loading loading-spinner"}):"Simpan Semua Pengaturan"})})]}),u&&e.jsx("div",{className:"toast toast-end toast-bottom z-50",children:e.jsx("div",{className:`alert alert-${u.type} shadow-lg`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[u.type==="success"?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:u.message})]})})})]})};export{D as default};
