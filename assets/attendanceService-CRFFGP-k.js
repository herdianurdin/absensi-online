import{c as d,m as y,i as p,d as i,g as m,A as l,n as R}from"./index-Dae3Oafu.js";import{a as v}from"./dateHelper-gvGk2ROa.js";const S=(t,e)=>{const n=d(i,`attendance_by_date/${t}`);return y(n,s=>{e(s.val()||{})})},k=(t,e)=>{const n=d(i,`attendanceRequests/${t}`);return y(n,s=>{const a=s.val(),o=[];a&&Object.keys(a).forEach(c=>{const u=a[c];u.status==="pending"&&o.push({...u,teacherId:c})}),e(o)})},w=(t,e,n)=>{const s=d(i,`attendance/${t}/${e}`);return y(s,a=>n(a.val()))},_=(t,e,n)=>{const s=d(i,`attendanceRequests/${e}/${t}`);return y(s,a=>n(a.val()))},T=async()=>{const t=d(i,"teachers/"),e=d(i,"settings/"),[n,s]=await Promise.all([m(t),m(e)]),a=n.val();return{teachers:a?Object.keys(a).map(c=>({id:c,...a[c]})):[],settings:s.val()||null}},O=async t=>{const e={};if(t.length===0)return e;const n=t.map(a=>m(d(i,`attendance_by_date/${a}`)));return(await Promise.all(n)).forEach((a,o)=>{const c=t[o];if(a.exists()){const u=a.val();for(const r in u)e[r]||(e[r]={}),e[r][c]=u[r]}}),e},A=async t=>{const e=d(i,`attendance/${t}`);return(await m(e)).val()},N=async(t,e,n,s)=>{const a={};a[`/attendance/${t}/${e}`]=n;let o=s;if(!o){const r=(await m(d(i,`attendance_by_date/${e}/${t}`))).val();if(o=r==null?void 0:r.teacherName,!o){const h=await m(d(i,`teachers/${t}`));h.exists()&&(o=h.val().name)}}const c={...n};return o&&(c.teacherName=o),a[`/attendance_by_date/${e}/${t}`]=c,p(d(i),a)},q=async(t,e,n)=>{const s={},o=(await m(d(i,"teachers"))).val()||{};return t.forEach(c=>{var $;const u=(($=o[c])==null?void 0:$.name)||"Nama Tidak Ditemukan",r={status:n,entryMethod:"admin",notes:"Status diubah secara massal oleh admin.",isStayingOvernight:!1},h={...r,teacherName:u};s[`/attendance/${c}/${e}`]=r,s[`/attendance_by_date/${e}/${c}`]=h}),p(d(i),s)},j=async(t,e,n)=>{const s={},o=(await m(d(i,"teachers"))).val()||{};return t.forEach(c=>{var $;const u=(($=o[c])==null?void 0:$.name)||"Nama Tidak Ditemukan",r={status:l.Libur,entryMethod:"admin",notes:n},h={...r,teacherName:u};s[`/attendance/${c}/${e}`]=r,s[`/attendance_by_date/${e}/${c}`]=h}),p(d(i),s)},F=(t,e)=>{const n={},s=Date.now();let a={status:t.requestedStatus,isStayingOvernight:t.isStayingOvernight,notes:t.notes,entryMethod:"admin"};t.isStayingOvernight&&(e==null?void 0:e.status)===l.Hadir&&(a={...e,...a});const o={...a,teacherName:t.teacherName};return n[`/attendance/${t.teacherId}/${t.date}`]=a,n[`/attendance_by_date/${t.date}/${t.teacherId}`]=o,n[`/attendanceRequests/${t.date}/${t.teacherId}/status`]="approved",n[`/attendanceRequests/${t.date}/${t.teacherId}/reviewedAt`]=s,p(d(i),n)},I=t=>{const e={},n=Date.now();return e[`/attendanceRequests/${t.date}/${t.teacherId}/status`]="rejected",e[`/attendanceRequests/${t.date}/${t.teacherId}/reviewedAt`]=n,p(d(i),e)},H=async(t,e,n)=>{var o,c;const s=v(n),a={};for(const u of t){const r=(o=e[u.id])==null?void 0:o[s],h=(c=e[u.id])==null?void 0:c[n];if(r!=null&&r.isStayingOvernight&&!h){const $=new Date(`${n}T00:00:00`),f={status:l.Hadir,checkIn:$.toISOString(),notes:"Absen masuk otomatis karena menginap dari hari sebelumnya.",entryMethod:"admin"},g={...f,teacherName:u.name};a[`/attendance/${u.id}/${n}`]=f,a[`/attendance_by_date/${n}/${u.id}`]=g}}Object.keys(a).length>0&&(await p(d(i),a),console.log(`Successfully created ${Object.keys(a).length/2} automatic check-ins.`))},M=(t,e,n)=>{const s=new Date(`${e}T00:00:00`),a={status:l.Hadir,checkIn:s.toISOString(),notes:"Absen masuk otomatis karena menginap dari hari sebelumnya.",entryMethod:"admin"},o={...a,teacherName:n},c={};return c[`/attendance/${t}/${e}`]=a,c[`/attendance_by_date/${e}/${t}`]=o,p(d(i),c)},E=(t,e,n)=>{const{requestedStatus:s,notes:a,isStayingOvernight:o,isOvernightRequest:c}=n,u={teacherId:t.uid,teacherName:t.name||t.email||"Nama Tidak Ditemukan",date:e,requestedStatus:c?l.Hadir:s,isStayingOvernight:c||o,notes:a,requestTimestamp:Date.now(),status:"pending"},r=d(i,`attendanceRequests/${e}/${t.uid}`);return R(r,u)};export{_ as a,k as b,M as c,S as d,j as e,F as f,A as g,q as h,T as i,O as j,w as l,H as p,I as r,E as s,N as u};
