import{c as i,m as y,i as l,d,g as $,A as p,n as R}from"./index-4LWUHDJo.js";import{a as v}from"./dateHelper-gvGk2ROa.js";const S=(t,e)=>{const a=i(d,`attendance_by_date/${t}`);return y(a,s=>{e(s.val()||{})})},k=(t,e)=>{const a=i(d,`attendanceRequests/${t}`);return y(a,s=>{const n=s.val(),u=[];n&&Object.keys(n).forEach(c=>{const o=n[c];o.status==="pending"&&u.push({...o,teacherId:c})}),e(u)})},w=(t,e,a)=>{const s=i(d,`attendance/${t}/${e}`);return y(s,n=>a(n.val()))},T=(t,e,a)=>{const s=i(d,`attendanceRequests/${e}/${t}`);return y(s,n=>a(n.val()))},_=async()=>{const t=i(d,"teachers/"),e=i(d,"settings/"),[a,s]=await Promise.all([$(t),$(e)]),n=a.val();return{teachers:n?Object.keys(n).map(c=>({id:c,...n[c]})):[],settings:s.val()||null}},O=async t=>{const e={};if(t.length===0)return e;const a=t.map(n=>$(i(d,`attendance_by_date/${n}`)));return(await Promise.all(a)).forEach((n,u)=>{const c=t[u];if(n.exists()){const o=n.val();for(const r in o)e[r]||(e[r]={}),e[r][c]=o[r]}}),e},A=async t=>{const e=i(d,`attendance/${t}`);return(await $(e)).val()},N=async(t,e,a,s)=>{const c={...(await $(i(d,`attendance/${t}/${e}`))).val()||{},...a},o={};o[`/attendance/${t}/${e}`]=c;let r=s;if(!r){const h=await $(i(d,`teachers/${t}`));h.exists()&&(r=h.val().name)}const m={...c};return r&&(m.teacherName=r),o[`/attendance_by_date/${e}/${t}`]=m,l(i(d),o)},q=async(t,e,a)=>{const s={},u=(await $(i(d,"teachers"))).val()||{};return t.forEach(c=>{var h;const o=((h=u[c])==null?void 0:h.name)||"Nama Tidak Ditemukan",r={status:a,entryMethod:"admin",notes:"Status diubah secara massal oleh admin.",isStayingOvernight:!1},m={...r,teacherName:o};s[`/attendance/${c}/${e}`]=r,s[`/attendance_by_date/${e}/${c}`]=m}),l(i(d),s)},F=async(t,e,a)=>{const s={},u=(await $(i(d,"teachers"))).val()||{};return t.forEach(c=>{var h;const o=((h=u[c])==null?void 0:h.name)||"Nama Tidak Ditemukan",r={status:p.Libur,entryMethod:"admin",notes:a},m={...r,teacherName:o};s[`/attendance/${c}/${e}`]=r,s[`/attendance_by_date/${e}/${c}`]=m}),l(i(d),s)},j=(t,e)=>{const a={},s=Date.now();let n={status:t.requestedStatus,isStayingOvernight:t.isStayingOvernight,notes:t.notes,entryMethod:"admin"};t.isStayingOvernight&&(e==null?void 0:e.status)===p.Hadir&&(n={...e,...n});const u={...n,teacherName:t.teacherName};return a[`/attendance/${t.teacherId}/${t.date}`]=n,a[`/attendance_by_date/${t.date}/${t.teacherId}`]=u,a[`/attendanceRequests/${t.date}/${t.teacherId}/status`]="approved",a[`/attendanceRequests/${t.date}/${t.teacherId}/reviewedAt`]=s,l(i(d),a)},I=t=>{const e={},a=Date.now();return e[`/attendanceRequests/${t.date}/${t.teacherId}/status`]="rejected",e[`/attendanceRequests/${t.date}/${t.teacherId}/reviewedAt`]=a,l(i(d),e)},H=async(t,e,a)=>{var u,c;const s=v(a),n={};for(const o of t){const r=(u=e[o.id])==null?void 0:u[s],m=(c=e[o.id])==null?void 0:c[a];if(r!=null&&r.isStayingOvernight&&!m){const h=new Date(`${a}T00:00:00`),f={status:p.Hadir,checkIn:h.toISOString(),notes:"Absen masuk otomatis karena menginap dari hari sebelumnya.",entryMethod:"admin"},g={...f,teacherName:o.name};n[`/attendance/${o.id}/${a}`]=f,n[`/attendance_by_date/${a}/${o.id}`]=g}}Object.keys(n).length>0&&(await l(i(d),n),console.log(`Successfully created ${Object.keys(n).length/2} automatic check-ins.`))},M=(t,e,a)=>{const s=new Date(`${e}T00:00:00`),n={status:p.Hadir,checkIn:s.toISOString(),notes:"Absen masuk otomatis karena menginap dari hari sebelumnya.",entryMethod:"admin"},u={...n,teacherName:a},c={};return c[`/attendance/${t}/${e}`]=n,c[`/attendance_by_date/${e}/${t}`]=u,l(i(d),c)},E=(t,e,a)=>{const{requestedStatus:s,notes:n,isStayingOvernight:u,isOvernightRequest:c}=a,o={teacherId:t.uid,teacherName:t.name||t.email||"Nama Tidak Ditemukan",date:e,requestedStatus:c?p.Hadir:s,isStayingOvernight:c||u,notes:n,requestTimestamp:Date.now(),status:"pending"},r=i(d,`attendanceRequests/${e}/${t.uid}`);return R(r,o)};export{T as a,k as b,M as c,S as d,F as e,j as f,A as g,q as h,_ as i,O as j,w as l,H as p,I as r,E as s,N as u};
