import{r as o,j as e,A as y,a as K,u as Y,S as B,T as U,f as F,b as _}from"./index-4LWUHDJo.js";import{g as Z}from"./dateHelper-gvGk2ROa.js";import{l as G,a as Q}from"./calendarService-BT4tN0gB.js";import{u as X,l as R,a as ee,c as ae,g as se,s as ne}from"./attendanceService-DA2Zw_0y.js";import{P as te}from"./Pagination-BVKH36FY.js";import{g as ie}from"./settingsService-yLoKs9nE.js";import{l as le}from"./scheduleService-ChXdVY-R.js";const re=({isOpen:a,onClose:s,onConfirm:n,title:c,children:i})=>a?e.jsxs("dialog",{id:"confirmation_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:c}),e.jsx("p",{className:"py-4",children:i}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn btn-ghost",onClick:s,children:"Batal"}),e.jsx("button",{className:"btn btn-primary",onClick:n,children:"Ya, Lanjutkan"})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:s,children:"close"})})]}):null,ce=(a,s,n,c)=>{const d=j=>j*Math.PI/180,t=d(a),r=d(n),x=d(n-a),m=d(c-s),l=Math.sin(x/2)*Math.sin(x/2)+Math.cos(t)*Math.cos(r)*Math.sin(m/2)*Math.sin(m/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},de=()=>e.jsx("div",{className:"card bg-warning text-warning-content shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),"Izin Lokasi Diperlukan"]}),e.jsx("p",{children:"Aplikasi ini memerlukan akses ke lokasi Anda untuk memverifikasi kehadiran. Saat ini akses lokasi diblokir."}),e.jsx("p",{className:"font-semibold mt-2",children:"Cara Mengaktifkan:"}),e.jsxs("ul",{className:"list-disc list-inside text-sm",children:[e.jsx("li",{children:"Klik ikon gembok (ðŸ”’) di sebelah alamat situs web pada browser Anda."}),e.jsx("li",{children:'Temukan pengaturan "Lokasi" dan ubah menjadi "Izinkan" (Allow).'}),e.jsx("li",{children:"Muat ulang halaman ini setelah mengubah pengaturan."})]})]})}),oe=({userProfile:a,settings:s,todayRecord:n,todayStr:c})=>{const[i,d]=o.useState(!1),[t,r]=o.useState(""),[x,m]=o.useState(),[l,g]=o.useState("loading"),[j,w]=o.useState(null),[v,T]=o.useState(!1),[h,p]=o.useState(null);o.useEffect(()=>{if(navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(b=>{g(b.state),b.onchange=()=>g(b.state)}):g("prompt"),c){const b=G(k=>{const f=k[c];if(f){const u=Object.values(f).find(N=>N.type==="Libur");w(u||null)}else w(null)});return()=>b()}},[c]);const D=o.useMemo(()=>{if(!c)return null;if(j)return j;if(s){const k=new Date(c).getUTCDay();if(k===0)return{title:"Libur Akhir Pekan",type:"Libur"};if(s.schoolDays===5&&k===6)return{title:"Libur Akhir Pekan",type:"Libur"}}return null},[c,j,s]);if(D)return e.jsx("div",{className:"card bg-info text-info-content shadow-xl",children:e.jsxs("div",{className:"card-body items-center text-center",children:[e.jsx("h2",{className:"card-title",children:"Hari Libur"}),e.jsx("p",{className:"font-semibold",children:D.title}),e.jsx("p",{children:"Anda tidak perlu melakukan absensi hari ini. Selamat berlibur!"})]})});if(!s||s.schoolLatitude===0)return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body items-center text-center",children:[e.jsx("h2",{className:"card-title",children:"Absensi Belum Aktif"}),e.jsx("p",{children:"Lokasi sekolah belum diatur oleh admin. Silakan hubungi administrator untuk mengaktifkan fitur absensi."})]})});const S=async(b,k)=>{if(!(a!=null&&a.uid)||!c){r("Profil guru tidak ditemukan atau tanggal tidak valid."),m("error"),d(!1);return}try{const f=new Date().toISOString(),u={status:y.Hadir,entryMethod:"guru"};b==="checkIn"?(u.checkIn=f,u.checkInLat=k.latitude,u.checkInLon=k.longitude):(u.checkOut=f,u.checkOutLat=k.latitude,u.checkOutLon=k.longitude),await X(a.uid,c,u),r(`Absensi ${b==="checkIn"?"masuk":"pulang"} berhasil!`),m("success")}catch(f){r("Gagal menyimpan data absensi ke server."),m("error"),console.error(f)}finally{d(!1)}},I=b=>{if(d(!0),r(""),m(void 0),!navigator.geolocation){r("Geolocation tidak didukung oleh browser Anda."),m("error"),d(!1);return}navigator.geolocation.getCurrentPosition(k=>{const{latitude:f,longitude:u}=k.coords,N=ce(f,u,s.schoolLatitude,s.schoolLongitude);if(N>s.maxDistanceMeters){r(`Anda berada sekitar ${Math.round(N)} meter dari sekolah. Jarak terlalu jauh untuk absensi (maksimal ${s.maxDistanceMeters} meter).`),m("error"),d(!1);return}S(b,{latitude:f,longitude:u})},k=>{if(k.code===k.PERMISSION_DENIED)g("denied");else{let f="Gagal mendapatkan lokasi. ";switch(k.code){case k.POSITION_UNAVAILABLE:f+="Informasi lokasi tidak tersedia.";break;case k.TIMEOUT:f+="Permintaan lokasi timed out.";break;default:f+="Terjadi kesalahan yang tidak diketahui.";break}r(f),m("error")}d(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},H=b=>{p(b),T(!0)},z=()=>{h&&I(h),T(!1),p(null)};if(l==="denied")return e.jsx(de,{});const A=!!(n!=null&&n.checkIn),C=!!(n!=null&&n.checkOut),O=()=>{if(n!=null&&n.status&&n.status!==y.Hadir)return`Status kehadiran Anda hari ini: ${n.status}.`;if(!A&&!C)return"Anda belum melakukan absensi hari ini.";let b="";return A&&(b+=`Anda sudah absen masuk pada jam ${new Date(n.checkIn).toLocaleTimeString("id-ID")}. `),C&&(b+=`Anda sudah absen pulang pada jam ${new Date(n.checkOut).toLocaleTimeString("id-ID")}.`),b.trim()};return e.jsxs("div",{className:"card bg-base-100 shadow-xl",children:[e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Absensi Berbasis Lokasi"}),e.jsx("p",{className:"text-base-content/70",children:"Pastikan Anda berada di area sekolah dan izinkan akses lokasi di browser Anda untuk melakukan absensi."}),e.jsx("div",{className:"divider"}),e.jsx("p",{className:"text-center font-semibold text-lg mb-4",children:O()}),e.jsxs("div",{className:"card-actions justify-center gap-4 flex-wrap",children:[e.jsxs("button",{className:"btn btn-primary w-full sm:w-auto sm:flex-1",onClick:()=>H("checkIn"),disabled:i||A||l==="loading",children:[i&&!A?e.jsx("span",{className:"loading loading-spinner"}):null,"Absen Masuk"]}),e.jsxs("button",{className:"btn btn-secondary w-full sm:w-auto sm:flex-1",onClick:()=>H("checkOut"),disabled:i||!A||C||l==="loading"||(n==null?void 0:n.isStayingOvernight),children:[i&&A&&!C?e.jsx("span",{className:"loading loading-spinner"}):null,"Absen Pulang"]})]}),t&&e.jsxs("div",{role:"alert",className:`alert ${x==="success"?"alert-success":"alert-error"} mt-4`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:t})]})]}),e.jsxs(re,{isOpen:v,onClose:()=>T(!1),onConfirm:z,title:`Konfirmasi Absensi ${h==="checkIn"?"Masuk":"Pulang"}`,children:["Apakah Anda yakin ingin melakukan absensi ",h==="checkIn"?"masuk":"pulang"," sekarang? Tindakan ini tidak dapat dibatalkan."]})]})},W=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],he=({schedules:a,timezone:s})=>{const[n,c]=o.useState(new Date);o.useEffect(()=>{const l=setInterval(()=>c(new Date),6e4);return()=>clearInterval(l)},[]);const i=new Date,d=i.getDay()===0?7:i.getDay(),t=a.filter(l=>l.dayOfWeek===d).sort((l,g)=>l.startTime.localeCompare(g.startTime));if(t.length===0)return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body items-center text-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-base-content/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("h2",{className:"card-title",children:"Jadwal Mengajar Hari Ini"}),e.jsxs("p",{className:"text-base-content/70 mt-2",children:["Anda tidak memiliki jadwal mengajar untuk hari ini, ",W[i.getDay()],"."]})]})});const r=n.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",timeZone:s}),x=(l,g)=>r>=l&&r<=g?"berlangsung":r<l?"akan-datang":"selesai",m=t.findIndex(l=>x(l.startTime,l.endTime)==="akan-datang");return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title",children:["Jadwal Mengajar Hari Ini (",W[i.getDay()],")"]}),e.jsx("div",{className:"divider my-1"}),e.jsx("div",{className:"space-y-3 mt-2",children:t.map((l,g)=>{const j=x(l.startTime,l.endTime),w=g===m;let v;switch(j){case"berlangsung":v=e.jsx("span",{className:"badge badge-success animate-pulse",children:"Sedang Berlangsung"});break;case"selesai":v=e.jsx("span",{className:"badge badge-ghost",children:"Selesai"});break;case"akan-datang":w&&(v=e.jsx("span",{className:"badge badge-info",children:"Berikutnya"}));break;default:v=null}const T=l.subjectName||l.subject,h=l.className||l.className;return e.jsxs("div",{className:`flex items-stretch rounded-lg overflow-hidden transition-all duration-300 shadow-sm
                                ${j==="berlangsung"?"bg-success/10 border-l-4 border-success":"bg-base-200"}
                                ${w?"bg-info/10 border-l-4 border-info":""}
                                ${j==="selesai"?"opacity-60 bg-base-200":""}
                            `,children:[e.jsxs("div",{className:"font-mono text-center flex-shrink-0 bg-base-300/50 p-3 flex flex-col justify-center w-24",children:[e.jsx("div",{className:"text-lg font-bold",children:l.startTime}),e.jsx("div",{className:"text-xs opacity-70",children:"hingga"}),e.jsx("div",{className:"text-lg font-bold",children:l.endTime})]}),e.jsxs("div",{className:"flex-grow p-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 opacity-70 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 16c1.255 0 2.443-.29 3.5-.804V4.804zM14.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 0114.5 16c1.255 0 2.443-.29 3.5-.804v-10A7.968 7.968 0 0014.5 4z"})}),T]}),e.jsxs("p",{className:"text-sm text-base-content/80 flex items-center gap-2 mt-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 opacity-70 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M9 6a3 3 0 11-6 0 3 3 0 016 0zm-1.559 5.568a.75.75 0 00-1.06 1.061 4.5 4.5 0 006.22 0 .75.75 0 00-1.06-1.061 3 3 0 01-4.1 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM9 13.5a4.5 4.5 0 006.22 0 .75.75 0 00-1.06-1.061 3 3 0 01-4.1 0 .75.75 0 00-1.06 1.061z"})}),"Kelas: ",h]})]}),e.jsx("div",{className:"flex-shrink-0 self-start pt-1",children:v})]})]},l.id)})})]})})},me=["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],ue=({schedules:a,schoolDays:s})=>{const n=me.slice(0,s);return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Jadwal Mengajar Lengkap Anda"}),e.jsx("div",{className:"divider my-1"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",children:n.map((c,i)=>{const d=a.filter(t=>t.dayOfWeek===i+1).sort((t,r)=>t.startTime.localeCompare(r.startTime));return e.jsxs("div",{className:"bg-base-200 p-3 rounded-box min-h-[200px]",children:[e.jsx("h3",{className:"font-bold text-xl text-center mb-4",children:c}),e.jsx("div",{className:"space-y-3",children:d.length>0?d.map(t=>e.jsx("div",{className:"card card-compact bg-base-100 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h4",{className:"card-title text-base",children:t.subjectName}),e.jsxs("p",{className:"text-sm font-mono",children:[t.startTime," - ",t.endTime]}),e.jsxs("p",{className:"text-xs opacity-60",children:["Kelas: ",t.className]})]})},t.id)):e.jsx("div",{className:"flex items-center justify-center h-full min-h-[100px]",children:e.jsx("p",{className:"text-center text-sm text-base-content/50",children:"Tidak ada jadwal"})})})]},c)})})]})})},xe=({userProfile:a,todayRecord:s,todayRequest:n,todayStr:c})=>{const[i,d]=o.useState(y.Sakit),[t,r]=o.useState(""),[x,m]=o.useState(!1),[l,g]=o.useState(!1),[j,w]=o.useState(""),v=async(p,D=!1)=>{if(p.preventDefault(),!a||!c)return;if(w(""),!t.trim()){w("Catatan wajib diisi.");return}g(!0);const S={requestedStatus:i,notes:t,isStayingOvernight:x,isOvernightRequest:D};try{await ne(a,c,S),r(""),m(!1)}catch(I){console.error(I),w("Gagal mengirim pengajuan. Coba lagi.")}finally{g(!1)}};if(n&&(n.status==="pending"||n.status==="approved")){let p,D;switch(n.status){case"pending":p="Pengajuan Anda sedang menunggu persetujuan dari admin.",D="alert-info";break;case"approved":p="Pengajuan Anda telah disetujui oleh admin.",D="alert-success";break}return e.jsxs("div",{className:`alert ${D} shadow-lg`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:p})]})}const T=!s,h=(s==null?void 0:s.status)===y.Hadir&&!s.isStayingOvernight;return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Ajukan Status Kehadiran"}),e.jsx("div",{className:"divider my-1"}),n&&n.status==="rejected"&&e.jsxs("div",{role:"alert",className:"alert alert-error mb-4",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Pengajuan Anda sebelumnya telah ditolak. Anda dapat mengajukan ulang di bawah ini."})]}),T&&e.jsxs("form",{onSubmit:v,children:[e.jsx("p",{className:"text-sm opacity-70 mb-4",children:"Jika Anda tidak dapat hadir, silakan ajukan status di bawah ini. Admin akan meninjau pengajuan Anda."}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Pilih Status"})}),e.jsxs("select",{className:"select select-bordered",value:i,onChange:p=>d(p.target.value),children:[e.jsx("option",{children:y.Sakit}),e.jsx("option",{children:y.Izin}),e.jsx("option",{children:y.Dinas})]})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catatan / Alasan"})}),e.jsx("textarea",{className:"textarea textarea-bordered",placeholder:"Contoh: Ada keperluan keluarga mendadak.",value:t,onChange:p=>r(p.target.value),required:!0})]}),e.jsx("div",{className:"card-actions justify-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l,children:l?e.jsx("span",{className:"loading loading-spinner"}):"Kirim Pengajuan"})})]}),h&&e.jsxs("form",{onSubmit:p=>v(p,!0),children:[e.jsx("p",{className:"text-sm opacity-70 mb-4",children:"Jika Anda akan menginap di sekolah dan tidak melakukan absen pulang, silakan ajukan status di bawah ini."}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catatan (Wajib)"})}),e.jsx("textarea",{className:"textarea textarea-bordered",placeholder:"Contoh: Ada kegiatan persiapan akreditasi.",value:t,onChange:p=>r(p.target.value),required:!0})]}),e.jsx("div",{className:"card-actions justify-end mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-info",disabled:l,children:l?e.jsx("span",{className:"loading loading-spinner"}):"Ajukan Menginap"})})]}),!T&&!h&&e.jsx("p",{className:"text-center p-4 text-base-content/60",children:"Anda sudah memiliki catatan absensi untuk hari ini. Tidak dapat membuat pengajuan baru."}),j&&e.jsx("p",{className:"text-error text-sm mt-2",children:j})]})})},E=15,ge=({history:a})=>{const[s,n]=o.useState(1),c=a?Object.keys(a).sort((t,r)=>new Date(r).getTime()-new Date(t).getTime()):[],i=Math.ceil(c.length/E),d=c.slice((s-1)*E,s*E);return o.useEffect(()=>{n(1)},[a]),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Riwayat Absensi Anda"}),e.jsx("div",{className:"overflow-x-auto mt-4",children:!a||c.length===0?e.jsx("p",{className:"text-center p-4",children:"Belum ada riwayat absensi."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tanggal"}),e.jsx("th",{children:"Jam Masuk"}),e.jsx("th",{children:"Jam Pulang"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:d.map(t=>{const r=a[t];return e.jsxs("tr",{children:[e.jsx("td",{children:new Date(t).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})}),e.jsx("td",{children:r.checkIn?new Date(r.checkIn).toLocaleTimeString("id-ID"):"-"}),e.jsx("td",{children:r.isStayingOvernight?"Menginap":r.checkOut?new Date(r.checkOut).toLocaleTimeString("id-ID"):"-"}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-ghost badge-sm",children:r.status})})]},t)})})]}),e.jsx(te,{currentPage:s,totalPages:i,onPageChange:n})]})})]})})},ke=({todayRecord:a})=>{const s=!!(a!=null&&a.checkIn),n=!!(a!=null&&a.checkOut);if(s&&n||a!=null&&a.status&&a.status!==y.Hadir||a!=null&&a.isStayingOvernight)return null;let c="Jangan Lupa Absen!",i="Pastikan Anda melakukan absensi datang saat tiba di sekolah dan absensi pulang sebelum meninggalkan sekolah.",d="alert-info";return s&&!n&&(c="Selesaikan Absensi Anda",i="Anda sudah berhasil melakukan absensi datang. Jangan lupa untuk melakukan absensi pulang sebelum meninggalkan area sekolah untuk melengkapi kehadiran hari ini.",d="alert-warning"),e.jsxs("div",{role:"alert",className:`alert ${d} shadow-lg`,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:c}),e.jsx("div",{className:"text-sm",children:i}),e.jsx("div",{className:"text-xs mt-1",children:"Persentase kehadiran Anda dihitung jika absensi datang-pulang lengkap, atau saat status 'Menginap'/'Dinas' disetujui."})]})]})},je=({userProfile:a,todayRecord:s,settings:n,todayStr:c})=>{if(a.employmentStatus!=="GTY"||!n||!c)return null;const d=new Date(c).getUTCDay();if(d===0||n.schoolDays===5&&d===6)return null;const t=()=>{if(!(s!=null&&s.checkIn)||!n.gtyMaxCheckInTime)return!1;try{const l=new Date(s.checkIn),[g,j]=n.gtyMaxCheckInTime.split(":").map(Number),w=new Date(l);return w.setHours(g,j,0,0),l>w}catch{return!1}},r=()=>{if(!(s!=null&&s.checkOut)||!n.gtyMinCheckOutTime||s.isStayingOvernight)return!1;try{const l=new Date(s.checkOut),[g,j]=n.gtyMinCheckOutTime.split(":").map(Number),w=new Date(l);return w.setHours(g,j,0,0),l<w}catch{return!1}},x=t(),m=r();return!x&&!m?null:e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs("div",{role:"alert",className:"alert alert-warning shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Keterlambatan"}),e.jsxs("div",{className:"text-sm",children:["Anda tercatat absen masuk pada pukul ",e.jsx("strong",{children:new Date(s.checkIn).toLocaleTimeString("id-ID")}),", melebihi batas waktu GTY yaitu pukul ",e.jsx("strong",{children:n.gtyMaxCheckInTime}),"."]})]})]}),m&&e.jsxs("div",{role:"alert",className:"alert alert-warning shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Pulang Awal"}),e.jsxs("div",{className:"text-sm",children:["Anda tercatat absen pulang pada pukul ",e.jsx("strong",{children:new Date(s.checkOut).toLocaleTimeString("id-ID")}),", lebih awal dari batas waktu minimal GTY yaitu pukul ",e.jsx("strong",{children:n.gtyMinCheckOutTime}),"."]})]})]})]})},be=({todayRecord:a,settings:s})=>{const n=()=>{if(!(a!=null&&a.checkIn)||!(s!=null&&s.piketMaxCheckInTime))return!1;try{const t=new Date(a.checkIn),[r,x]=s.piketMaxCheckInTime.split(":").map(Number),m=new Date(t);return m.setHours(r,x,0,0),t>m}catch{return!1}},c=()=>{if(!(a!=null&&a.checkOut)||!(s!=null&&s.piketMinCheckOutTime)||a.isStayingOvernight)return!1;try{const t=new Date(a.checkOut),[r,x]=s.piketMinCheckOutTime.split(":").map(Number),m=new Date(t);return m.setHours(r,x,0,0),t<m}catch{return!1}},i=n(),d=c();return!i&&!d?null:e.jsxs("div",{className:"space-y-4",children:[i&&e.jsxs("div",{role:"alert",className:"alert alert-error shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Keterlambatan Piket"}),e.jsxs("div",{className:"text-sm",children:["Anda tercatat absen masuk pada pukul ",e.jsx("strong",{children:new Date(a.checkIn).toLocaleTimeString("id-ID")}),", melebihi batas waktu piket yaitu pukul ",e.jsx("strong",{children:s.piketMaxCheckInTime}),"."]})]})]}),d&&e.jsxs("div",{role:"alert",className:"alert alert-error shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Pulang Awal (Piket)"}),e.jsxs("div",{className:"text-sm",children:["Anda tercatat absen pulang pada pukul ",e.jsx("strong",{children:new Date(a.checkOut).toLocaleTimeString("id-ID")}),", lebih awal dari batas waktu minimal piket yaitu pukul ",e.jsx("strong",{children:s.piketMinCheckOutTime}),"."]})]})]})]})},pe=({todayRecord:a,schedules:s,todayStr:n,timezone:c})=>{const i=o.useMemo(()=>{if(!n)return[];const t=new Date(n),r=t.getUTCDay()===0?7:t.getUTCDay();return s.filter(x=>x.dayOfWeek===r).sort((x,m)=>x.startTime.localeCompare(m.startTime))},[s,n]),d=o.useMemo(()=>{const t={late:!1,early:!1};if(!a||i.length===0)return t;const r=i[0],x=i[i.length-1];return a.checkIn&&new Date(a.checkIn).toLocaleTimeString("sv-SE",{timeZone:c})>r.startTime&&(t.late=!0),a.checkOut&&!a.isStayingOvernight&&new Date(a.checkOut).toLocaleTimeString("sv-SE",{timeZone:c})<x.endTime&&(t.early=!0),t},[a,i,c]);return!d.late&&!d.early?null:e.jsxs("div",{className:"space-y-4",children:[d.late&&e.jsxs("div",{role:"alert",className:"alert alert-warning shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Absensi"}),e.jsx("div",{className:"text-sm",children:"Anda tercatat absen masuk setelah jam pelajaran pertama Anda dimulai hari ini."})]})]}),d.early&&e.jsxs("div",{role:"alert",className:"alert alert-warning shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Peringatan Absensi"}),e.jsx("div",{className:"text-sm",children:"Anda tercatat absen pulang sebelum jam pelajaran terakhir Anda selesai hari ini."})]})]})]})},fe=({settings:a})=>e.jsxs("div",{role:"alert",className:"alert alert-info shadow-lg",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 01-1-1v-4a1 1 0 011-1h1V6H6z",clipRule:"evenodd"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Anda Bertugas Piket Hari Ini!"}),e.jsxs("div",{className:"text-sm",children:["Mohon untuk hadir lebih awal dan melakukan absensi masuk sebelum pukul ",e.jsx("strong",{children:(a==null?void 0:a.piketMaxCheckInTime)||"yang ditentukan"}),"."]})]})]}),Le=()=>{var f;const{userProfile:a,loading:s}=K(),[n,c]=o.useState(null),[i,d]=o.useState(null),[t,r]=o.useState(null),[x,m]=o.useState(null),[l,g]=o.useState([]),[j,w]=o.useState({}),[v,T]=o.useState(!0),[h,p]=o.useState(""),D=Y(),[S,I]=o.useState("absensi"),[H,z]=o.useState(new Date),[A,C]=o.useState(!1),O=(i==null?void 0:i.timezone)||"Asia/Jakarta";o.useEffect(()=>{const u=setInterval(()=>z(new Date),1e3);return()=>clearInterval(u)},[]),o.useEffect(()=>{p(Z(O))},[O]);const b=async()=>{try{await F(_),D("/login")}catch(u){console.error("Error signing out:",u),alert("Gagal untuk logout.")}};o.useEffect(()=>{if(s||!(a!=null&&a.uid)||!h)return;let u=!0;T(!0),(async()=>{try{const[L,P]=await Promise.all([ie(),se(a.uid)]);u&&(d(L),c(P))}catch(L){console.error("Error fetching initial data:",L)}})();const M=R(a.uid,h,L=>{u&&(r(L),v&&T(!1))}),$=ee(a.uid,h,m),J=le(L=>{u&&g(L.filter(P=>P.teacherId===a.uid))}),q=G(w),V=Q(h,L=>{u&&C(!!L&&!!L[a.uid])});return()=>{u=!1,M(),$(),J(),q(),V()}},[a,s,h]),o.useEffect(()=>{if(!(a!=null&&a.uid)||!n||!h)return;const u=new Date(new Date(h).setDate(new Date(h).getDate()-1)).toISOString().split("T")[0],N=n[u],M=!!n[h];N!=null&&N.isStayingOvernight&&!M&&ae(a.uid,h,a.name||"").catch(console.error)},[a,n,h]);const k=o.useMemo(()=>{if(!h)return null;const u=j[h];if(u){const N=Object.values(u).find(M=>M.type==="Libur");if(N)return N}if(i){const M=new Date(h).getUTCDay();if(M===0||i.schoolDays===5&&M===6)return{title:"Libur Akhir Pekan",type:"Libur"}}return null},[h,j,i]);return s||v||!h?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-base-200",children:e.jsx(B,{})}):a?e.jsxs("div",{className:"flex flex-col min-h-screen bg-base-200 text-base-content",children:[e.jsxs("header",{className:"p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"avatar placeholder",children:e.jsx("div",{className:"bg-neutral text-neutral-content rounded-full w-10",children:e.jsx("span",{className:"text-sm",children:(f=((a==null?void 0:a.name)||"?").match(/\b(\w)/g))==null?void 0:f.join("").slice(0,2)})})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:a==null?void 0:a.name}),e.jsx("div",{className:"text-xs opacity-70",children:a==null?void 0:a.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{}),e.jsx("button",{onClick:b,className:"btn btn-ghost btn-circle","aria-label":"Logout",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]}),e.jsxs("main",{className:"max-w-4xl mx-auto pb-8 px-4 flex-grow w-full",children:[e.jsxs("div",{className:"card bg-primary text-primary-content shadow-lg mb-8 text-center p-6",children:[e.jsx("div",{className:"opacity-80 text-lg",children:e.jsx("p",{children:H.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})}),e.jsx("p",{className:"text-5xl font-mono font-bold tracking-wider mt-1",children:H.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),e.jsxs("div",{role:"alert",className:"alert alert-info shadow-lg mb-8",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Informasi Aturan Absensi"}),e.jsxs("div",{className:"text-xs space-y-1 mt-1",children:[A&&(i==null?void 0:i.piketMaxCheckInTime)&&e.jsxs("p",{className:"font-bold",children:[e.jsx("span",{className:"badge badge-error badge-sm mr-1",children:"PIKET"}),"Guru Piket: Wajib absen masuk sebelum pukul ",i.piketMaxCheckInTime,"."]}),e.jsxs("p",{className:a.employmentStatus==="GTY"?"font-bold":"",children:[e.jsx("span",{className:"badge badge-primary badge-sm mr-1",children:"GTY"}),e.jsx("strong",{children:"Guru Tetap Yayasan:"})," Wajib absen sesuai jam yang ditentukan admin."]}),e.jsxs("p",{className:a.employmentStatus==="GTT"?"font-bold":"",children:[e.jsx("span",{className:"badge badge-secondary badge-sm mr-1",children:"GTT"}),e.jsx("strong",{children:"Guru Tidak Tetap:"})," Absensi dapat dilakukan kapan saja sesuai jadwal mengajar."]})]})]})]}),e.jsxs("div",{role:"tablist",className:"tabs tabs-lifted mb-8",children:[e.jsxs("a",{role:"tab",className:`tab [--tab-bg:oklch(var(--b1))] ${S==="absensi"?"tab-active":""} flex items-center gap-2`,onClick:()=>I("absensi"),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),e.jsx("span",{className:"hidden sm:inline",children:"Absensi Hari Ini"})]}),e.jsxs("a",{role:"tab",className:`tab [--tab-bg:oklch(var(--b1))] ${S==="riwayat"?"tab-active":""} flex items-center gap-2`,onClick:()=>I("riwayat"),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})]}),e.jsx("span",{className:"hidden sm:inline",children:"Riwayat Absensi"})]}),e.jsxs("a",{role:"tab",className:`tab [--tab-bg:oklch(var(--b1))] ${S==="jadwal"?"tab-active":""} flex items-center gap-2`,onClick:()=>I("jadwal"),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z",clipRule:"evenodd"})}),e.jsx("span",{className:"hidden sm:inline",children:"Jadwal Mengajar"})]})]}),S==="absensi"&&e.jsx("div",{className:"space-y-8",children:k?e.jsx("div",{className:"card bg-info text-info-content shadow-xl",children:e.jsxs("div",{className:"card-body items-center text-center",children:[e.jsx("h2",{className:"card-title",children:"Hari Libur"}),e.jsx("p",{className:"font-semibold",children:k.title}),e.jsx("p",{children:"Jadwal mengajar dan absensi dinonaktifkan hari ini. Selamat berlibur!"})]})}):e.jsxs(e.Fragment,{children:[A&&e.jsx(fe,{settings:i}),e.jsx(oe,{userProfile:a,settings:i,todayRecord:t,todayStr:h}),e.jsx(he,{schedules:l,timezone:O}),A?e.jsx(be,{todayRecord:t,settings:i}):e.jsx(je,{userProfile:a,todayRecord:t,settings:i,todayStr:h}),e.jsx(pe,{todayRecord:t,schedules:l,todayStr:h,timezone:O}),e.jsx(ke,{todayRecord:t}),e.jsx(xe,{userProfile:a,todayRecord:t,todayRequest:x,todayStr:h})]})}),S==="riwayat"&&e.jsx(ge,{history:n}),S==="jadwal"&&e.jsx(ue,{schedules:l,schoolDays:(i==null?void 0:i.schoolDays)??6})]}),e.jsx("footer",{className:"footer footer-center p-4 bg-base-300 text-base-content mt-8",children:e.jsx("aside",{children:e.jsxs("p",{children:["Copyright Â© ",new Date().getFullYear()," - All right reserved by Absensi Online"]})})})]}):e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-base-200",children:e.jsx(B,{})})};export{Le as default};
