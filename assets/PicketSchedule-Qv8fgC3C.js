import{r as s,j as e,S as w}from"./index-Dae3Oafu.js";import{l as T}from"./teacherService-DYAXRTCH.js";import{g as M}from"./settingsService-BfV9uKhR.js";import{c as C,e as P}from"./calendarService-CJ4EbO9y.js";const D=({isOpen:r,onClose:p,onSave:m,dayName:y,allTeachers:c,initialTeacherIds:b})=>{const[g,u]=s.useState(new Set),[h,i]=s.useState("");s.useEffect(()=>{r&&(u(new Set(b)),i(""))},[r,b]);const n=a=>{u(S=>{const d=new Set(S);return d.has(a)?d.delete(a):d.add(a),d})},N=()=>{m(Array.from(g))},j=s.useMemo(()=>c.filter(a=>a.name.toLowerCase().includes(h.toLowerCase())),[c,h]);return r?e.jsxs("dialog",{id:"picket_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box w-11/12 max-w-2xl",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Atur Guru Piket untuk Hari ",y]}),e.jsx("input",{type:"text",placeholder:"Cari nama guru...",className:"input input-bordered w-full my-2",value:h,onChange:a=>i(a.target.value)}),e.jsx("div",{className:"form-control max-h-60 overflow-y-auto mt-2 p-2 bg-base-200 rounded-lg",children:j.length>0?j.map(a=>e.jsxs("label",{className:"label cursor-pointer hover:bg-base-100 rounded-md",children:[e.jsx("span",{className:"label-text",children:a.name}),e.jsx("input",{type:"checkbox",checked:g.has(a.id),onChange:()=>n(a.id),className:"checkbox checkbox-primary"})]},a.id)):e.jsx("p",{className:"text-center p-4",children:"Tidak ada guru ditemukan."})}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn btn-ghost",onClick:p,children:"Batal"}),e.jsx("button",{className:"btn btn-primary",onClick:N,children:"Simpan Jadwal"})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:p,children:"close"})})]}):null},J=()=>{const[r,p]=s.useState({}),[m,y]=s.useState([]),[c,b]=s.useState(null),[g,u]=s.useState(!0),[h,i]=s.useState(!1),[n,N]=s.useState(null);s.useEffect(()=>{u(!0),(async()=>{try{const o=await M();b(o)}catch(o){console.error("Failed to fetch settings:",o)}})();const l=T(o=>y(o.filter(f=>f.status==="aktif"))),x=C(p);return setTimeout(()=>u(!1),500),()=>{l(),x()}},[]);const j=s.useMemo(()=>new Map(m.map(t=>[t.id,t.name])),[m]),a=s.useMemo(()=>["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"].slice(0,(c==null?void 0:c.schoolDays)??6),[c]),S=(t,l)=>{N({dayIndex:t,dayName:l}),i(!0)},d=async t=>{if(n)try{await P(n.dayIndex,t),i(!1)}catch(l){console.error("Gagal menyimpan jadwal piket:",l),alert("Gagal menyimpan jadwal piket.")}};if(g)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(w,{})});const v=n?Object.keys(r[n.dayIndex]||{}):[];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Jadwal Piket Mingguan"}),e.jsx("p",{className:"mb-6 text-base-content/70",children:"Atur guru piket untuk setiap hari kerja. Jadwal ini akan berulang secara otomatis setiap minggunya."}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map((t,l)=>{const x=l+1,f=Object.keys(r[x]||{}).map(k=>j.get(k)||"Guru Dihapus").sort();return e.jsx("div",{className:"card bg-base-200 shadow",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:t}),e.jsx("div",{className:"divider my-1"}),e.jsx("div",{className:"min-h-[6rem] space-y-1",children:f.length>0?f.map(k=>e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx("span",{className:"text-lg",children:"ðŸš©"}),e.jsx("span",{children:k})]},k)):e.jsx("p",{className:"text-sm text-base-content/50 italic pt-4 text-center",children:"Belum ada guru piket"})}),e.jsx("div",{className:"card-actions justify-end mt-2",children:e.jsx("button",{className:"btn btn-sm btn-outline btn-primary",onClick:()=>S(x,t),children:"Atur Guru"})})]})},x)})})})}),e.jsx(D,{isOpen:h,onClose:()=>i(!1),onSave:d,dayName:(n==null?void 0:n.dayName)||"",allTeachers:m,initialTeacherIds:v})]})};export{J as default};
