import{r as n,j as e,S as V}from"./index-4LWUHDJo.js";import{l as W,d as X,u as Z,b as ee,s as ae}from"./calendarService-BT4tN0gB.js";import{g as te}from"./settingsService-yLoKs9nE.js";const se=({isOpen:i,onClose:m,onAdd:f,onUpdate:b,onDelete:l,selectedDate:g,dailyEvents:S})=>{const[x,C]=n.useState(""),[A,u]=n.useState("Libur"),[N,r]=n.useState(null);n.useEffect(()=>{i&&y()},[i,g]);const y=()=>{C(""),u("Libur"),r(null)},v=(o,j)=>{var h;r(o),C(j.title),u(j.type),(h=document.getElementById("event-title-input"))==null||h.focus()},D=o=>{if(o.preventDefault(),!x.trim()){alert("Judul tidak boleh kosong.");return}const j={title:x,type:A};N?b(N,j):f(j),y()},Y=o=>{window.confirm("Yakin ingin menghapus acara ini?")&&(l(o),N===o&&y())};if(!i||!g)return null;const k=S?Object.entries(S):[];return e.jsxs("dialog",{id:"manage_events_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box w-11/12 max-w-2xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Kelola Acara"}),e.jsxs("p",{className:"py-2",children:["Untuk tanggal: ",g.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsx("div",{className:"divider my-2",children:"Acara Terdaftar"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:k.length>0?k.map(([o,j])=>{const h=j;return e.jsxs("div",{className:"flex justify-between items-center bg-base-200 p-2 rounded-lg animation-fade-in",children:[e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("span",{className:`badge ${h.type==="Libur"?"badge-error":"badge-info"} mr-2`,children:h.type}),e.jsx("span",{className:"truncate",children:h.title})]}),e.jsxs("div",{className:"space-x-2 flex-shrink-0",children:[e.jsx("button",{className:"btn btn-xs btn-outline",onClick:()=>v(o,h),children:"Edit"}),e.jsx("button",{className:"btn btn-xs btn-error",onClick:()=>Y(o),children:"Hapus"})]})]},o)}):e.jsx("p",{className:"text-center text-sm text-base-content/60 py-4",children:"Belum ada acara pada tanggal ini."})}),e.jsx("div",{className:"divider my-2",children:N?"Edit Acara":"Tambah Acara Baru"}),e.jsxs("form",{onSubmit:D,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Judul Acara"})}),e.jsx("input",{id:"event-title-input",type:"text",placeholder:"Contoh: Libur Nasional Maulid Nabi",className:"input input-bordered w-full",value:x,onChange:o=>C(o.target.value),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tipe"})}),e.jsxs("select",{className:"select select-bordered w-full",value:A,onChange:o=>u(o.target.value),children:[e.jsx("option",{value:"Libur",children:"Hari Libur"}),e.jsx("option",{value:"Acara Sekolah",children:"Acara Sekolah"})]}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:'"Hari Libur" akan menonaktifkan absensi guru pada tanggal tersebut.'})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[N&&e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:y,children:"Batal Edit"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:N?"Update Acara":"Tambah Acara"})]})]}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn",onClick:m,children:"Tutup"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:m,children:"close"})})]})},ne=({isOpen:i,onClose:m,onConfirm:f,availableYears:b,isSyncing:l})=>{const[g,S]=n.useState(b[0]||"");return n.useEffect(()=>{b.length>0&&!b.includes(g)&&S(b[0])},[b,g]),i?e.jsxs("dialog",{id:"sync_holidays_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Sinkronkan Hari Libur Nasional"}),e.jsx("p",{className:"py-4",children:"Pilih tahun untuk mengimpor daftar hari libur nasional dan cuti bersama dari API publik Nager.Date. Tindakan ini hanya akan MENAMBAHKAN hari libur yang belum ada dan tidak akan menghapus acara yang sudah Anda buat."}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Pilih Tahun"})}),e.jsx("select",{className:"select select-bordered",value:g,onChange:x=>S(x.target.value),disabled:l,children:b.map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn btn-ghost",onClick:m,disabled:l,children:"Batal"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>f(g),disabled:l||!g,children:l?e.jsx("span",{className:"loading loading-spinner"}):"Ya, Sinkronkan"})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:m,children:"close"})})]}):null},le=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],re=["Min","Sen","Sel","Rab","Kam","Jum","Sab"],K=[7,8,9,10,11,12],ce=[1,2,3,4,5,6],M=i=>{const m=i.getFullYear(),f=String(i.getMonth()+1).padStart(2,"0"),b=String(i.getDate()).padStart(2,"0");return`${m}-${f}-${b}`},me=()=>{var $,L,H;const[i,m]=n.useState(new Date),[f,b]=n.useState({}),[l,g]=n.useState(null),[S,x]=n.useState(!0),[C,A]=n.useState(!1),[u,N]=n.useState(null),[r,y]=n.useState(""),[v,D]=n.useState("Ganjil"),[Y,k]=n.useState(!1),[o,j]=n.useState(!1);n.useEffect(()=>{x(!0),te().then(g).catch(t=>{console.error("Gagal mengambil data pengaturan:",t)});const a=W(t=>{b(t),x(!1)});return()=>a()},[]),n.useEffect(()=>{if(l&&!r){const a=l.academicYears||[];if(a.length>0){const t=new Date,s=t.getFullYear(),d=t.getMonth()+1,c=K.includes(d)?"Ganjil":"Genap",p=c==="Ganjil"?`${s}/${s+1}`:`${s-1}/${s}`;if(a.includes(p))y(p),D(c),m(new Date(s,d-1,1));else{const w=a[0];y(w),D("Ganjil");const E=parseInt(w.split("/")[0]);m(new Date(E,6,1))}}}},[l,r]);const h=n.useMemo(()=>r?v==="Ganjil"?K:ce:[],[r,v]),T=h.indexOf(i.getMonth()+1),B=n.useMemo(()=>{const a=i.getFullYear(),t=i.getMonth(),s=new Date(a,t,1).getDay(),d=new Date(a,t+1,0).getDate(),c=[];for(let p=0;p<s;p++)c.push(null);for(let p=1;p<=d;p++)c.push(new Date(a,t,p));return c},[i]),O=a=>{const t=T+a;if(t>=0&&t<h.length){const s=h[t],d=v==="Ganjil"?parseInt(r.split("/")[0]):parseInt(r.split("/")[0])+1;m(new Date(d,s-1,1))}},_=a=>{const t=a.target.value;y(t);const s=parseInt(t.split("/")[0]),d=v==="Ganjil"?6:0,c=v==="Ganjil"?s:s+1;m(new Date(c,d,1))},J=a=>{const t=a.target.value;if(D(t),r){const s=parseInt(r.split("/")[0]),d=t==="Ganjil"?6:0,c=t==="Ganjil"?s:s+1;m(new Date(c,d,1))}},z=a=>{N(a),A(!0)},P=async a=>{if(u){const t=M(u);try{await ee(t,a)}catch(s){console.error("Gagal menambahkan acara:",s),alert("Gagal menambahkan acara.")}}},R=async(a,t)=>{if(u){const s=M(u);try{await Z(s,a,t)}catch(d){console.error("Gagal memperbarui acara:",d),alert("Gagal memperbarui acara.")}}},U=async a=>{if(u){const t=M(u);try{await X(t,a)}catch(s){console.error("Gagal menghapus acara:",s),alert("Gagal menghapus acara.")}}},q=async a=>{j(!0);const t=await ae(a);alert(t.message),j(!1),k(!1)},Q=n.useMemo(()=>{if(!r)return[];const a=r.split("/");return a.length===2&&!isNaN(parseInt(a[0]))&&!isNaN(parseInt(a[1]))?[a[0],a[1]]:[]},[r]);return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Kalender Akademik"}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[e.jsxs("select",{className:"select select-bordered",value:r,onChange:_,disabled:!(($=l==null?void 0:l.academicYears)!=null&&$.length),children:[!((L=l==null?void 0:l.academicYears)!=null&&L.length)&&e.jsx("option",{children:"Tahun Ajaran belum diatur"}),(H=l==null?void 0:l.academicYears)==null?void 0:H.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{className:"select select-bordered",value:v,onChange:J,disabled:!r,children:[e.jsx("option",{value:"Ganjil",children:"Ganjil"}),e.jsx("option",{value:"Genap",children:"Genap"})]})]}),e.jsxs("button",{className:"btn btn-accent",onClick:()=>k(!0),disabled:!r,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 01-9.201-4.42 5.5 5.5 0 011.023-2.013A5.5 5.5 0 0112.72 2.025a5.5 5.5 0 014.934 9.399zm-3.882-2.126a3.5 3.5 0 11-5.132-3.238 3.5 3.5 0 015.132 3.238zM1.168 13.973a.75.75 0 01.144-1.062 5.5 5.5 0 018.73-1.42.75.75 0 01-1.206.872a4 4 0 00-6.287 1.033.75.75 0 01-1.061-.144zM18.832 13.973a.75.75 0 01-1.061 1.062 5.5 5.5 0 01-8.73-1.42.75.75 0 111.206-.872 4 4 0 006.287 1.033.75.75 0 01.305 1.207z",clipRule:"evenodd"})}),"Sinkronkan Hari Libur Nasional"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>O(-1),disabled:T<=0,children:"« Sebelumnya"}),e.jsxs("h2",{className:"text-2xl font-bold text-center",children:[le[i.getMonth()]," ",i.getFullYear()]}),e.jsx("button",{className:"btn btn-ghost",onClick:()=>O(1),disabled:h.length===0||T>=h.length-1,children:"Berikutnya »"})]}),S?e.jsx("div",{className:"text-center p-10",children:e.jsx(V,{})}):e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[re.map((a,t)=>e.jsx("div",{className:`text-center font-bold p-2 text-base-content/70 ${t===0?"text-error":""}`,children:a},a)),B.map((a,t)=>{if(!a)return e.jsx("div",{className:"border rounded-lg border-base-300"},`empty-${t}`);const s=M(a),d=f[s],c=d?Object.values(d):[],p=M(new Date)===s,w=a.getDay()===0,E=c.some(I=>I.type==="Libur"),F=c.some(I=>I.type==="Acara Sekolah");let G="bg-base-200";return(E||w)&&F?G="bg-gradient-to-br from-error/20 to-info/20":E||w?G="bg-error/20":F&&(G="bg-info/20"),e.jsxs("div",{className:`p-2 h-24 md:h-32 flex flex-col border rounded-lg cursor-pointer hover:bg-base-300 transition-colors duration-200
                                            ${G}
                                            ${p?"border-primary border-2":"border-base-300"}
                                        `,onClick:()=>z(a),children:[e.jsx("div",{className:`font-bold ${p?"text-primary":""} ${w||E?"text-error":""}`,children:a.getDate()}),c.length>0&&e.jsxs("div",{className:"text-xs mt-1 overflow-hidden",children:[e.jsx("p",{className:"truncate font-semibold",children:c[0].title}),c.length>1&&e.jsxs("p",{className:"text-xs opacity-70",children:["+",c.length-1," acara lagi"]})]})]},a.toString())})]})]})}),e.jsx(se,{isOpen:C,onClose:()=>A(!1),onAdd:P,onUpdate:R,onDelete:U,selectedDate:u,dailyEvents:u&&f[M(u)]||null}),e.jsx(ne,{isOpen:Y,onClose:()=>k(!1),onConfirm:q,availableYears:Q,isSyncing:o})]})};export{me as default};
