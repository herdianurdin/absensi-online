import{r,E as b,j as e,S as K,i as B,c as _,d as z}from"./index-4LWUHDJo.js";import{P as D}from"./Pagination-BVKH36FY.js";import{d as q,i as Y}from"./excelHelper-DCx7gnhq.js";import{l as $,u as F,a as H}from"./teacherService-2Pq2ufkF.js";import"./dateHelper-gvGk2ROa.js";const Q=({isOpen:m,onClose:o,onSave:x,formData:n,setFormData:l,selectedTeacher:u})=>m?e.jsxs("dialog",{id:"add_edit_teacher_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:u?"Edit Data Guru":"Tambah Guru Baru"}),e.jsxs("form",{onSubmit:x,className:"space-y-4 py-4",children:[!u&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"User UID"})}),e.jsx("input",{type:"text",placeholder:"UID dari Firebase Auth",className:"input input-bordered w-full",value:n.uid,onChange:t=>l(s=>({...s,uid:t.target.value})),required:!0}),e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt",children:"Buat pengguna di Firebase Authentication dahulu untuk dapat UID ini."})})]}),e.jsx("input",{type:"text",placeholder:"ID Pengguna (NIK)",className:"input input-bordered w-full",value:n.nik,onChange:t=>l(s=>({...s,nik:t.target.value})),required:!0}),e.jsx("input",{type:"text",placeholder:"Nama Lengkap",className:"input input-bordered w-full",value:n.name,onChange:t=>l(s=>({...s,name:t.target.value})),required:!0}),e.jsx("input",{type:"email",placeholder:"Email",className:"input input-bordered w-full",value:n.email,onChange:t=>l(s=>({...s,email:t.target.value})),required:!0}),e.jsx("input",{type:"text",placeholder:"Username (tanpa spasi, huruf kecil)",className:"input input-bordered w-full",value:n.username,onChange:t=>l(s=>({...s,username:t.target.value})),required:!0}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Status Kepegawaian"})}),e.jsxs("select",{className:"select select-bordered w-full",value:n.employmentStatus,onChange:t=>l(s=>({...s,employmentStatus:t.target.value})),children:[e.jsx("option",{value:b.GTT,children:"GTT (Guru Tidak Tetap)"}),e.jsx("option",{value:b.GTY,children:"GTY (Guru Tetap Yayasan)"})]})]}),u&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Status Guru"})}),e.jsxs("select",{className:"select select-bordered w-full",value:n.status,onChange:t=>l(s=>({...s,status:t.target.value})),children:[e.jsx("option",{value:"aktif",children:"Aktif"}),e.jsx("option",{value:"nonaktif",children:"Nonaktif"})]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:o,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:u?"Update Data":"Tambah Guru"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:o,children:"close"})})]}):null,V=({isOpen:m,onClose:o,onImport:x,fileInputRef:n})=>m?e.jsxs("dialog",{id:"import_teacher_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Impor Data Massal"}),e.jsx("p",{className:"py-4",children:"Unggah file Excel (.xlsx, .xls) untuk menambahkan beberapa guru sekaligus. Pastikan setiap guru sudah memiliki User UID dari Firebase Authentication. Unduh template untuk memastikan formatnya benar."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsx("input",{type:"file",className:"file-input file-input-bordered w-full max-w-xs hidden",ref:n,onChange:x,accept:".xlsx, .xls"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>{var l;return(l=n.current)==null?void 0:l.click()},children:"Pilih File Excel"}),e.jsx("button",{className:"btn btn-accent",onClick:q,children:"Unduh Template"})]}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn",onClick:o,children:"Tutup"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:o,children:"close"})})]}):null,w=25,te=()=>{const[m,o]=r.useState([]),[x,n]=r.useState(!0),[l,u]=r.useState(null),t=r.useRef(null),[s,g]=r.useState({uid:"",nik:"",name:"",email:"",username:"",status:"aktif",employmentStatus:b.GTT}),[G,h]=r.useState(!1),[E,N]=r.useState(!1),[v,y]=r.useState(1),[f,I]=r.useState(""),[p,T]=r.useState("aktif");r.useEffect(()=>{n(!0);const a=$(i=>{o(i),n(!1)});return()=>a()},[]),r.useEffect(()=>{y(1)},[p,f]);const j=m.reduce((a,i)=>(i.status==="aktif"?a.aktif++:a.nonaktif++,a),{aktif:0,nonaktif:0}),S=m.filter(a=>a.status===p).filter(a=>a.name.toLowerCase().includes(f.toLowerCase())||a.nik.includes(f)),M=Math.ceil(S.length/w),C=S.slice((v-1)*w,v*w),k=()=>{u(null),g({uid:"",nik:"",name:"",email:"",username:"",status:"aktif",employmentStatus:b.GTT})},A=a=>{a.preventDefault();const{uid:i,...d}=s;if(!i||!d.nik||!d.name||!d.email||!d.username){alert("Harap isi semua field.");return}H(i,d).then(()=>{k(),h(!1)}).catch(c=>{console.error("Gagal menambahkan guru baru:",c),alert("Gagal menambahkan guru baru. Periksa kembali UID dan data lainnya.")})},P=a=>{u(a),g({uid:a.id,nik:a.nik,name:a.name,email:a.email,username:a.username,status:a.status,employmentStatus:a.employmentStatus||b.GTT}),h(!0)},U=()=>{k(),h(!0)},L=a=>{if(a.preventDefault(),l){const{uid:i,...d}=s;F(l.id,d).then(()=>{k(),h(!1)}).catch(c=>{console.error("Gagal mengupdate data guru:",c),alert("Gagal mengupdate data guru.")})}},O=async a=>{var d;const i=(d=a.target.files)==null?void 0:d[0];if(i)try{const{updates:c,count:R}=await Y(i);Object.keys(c).length>0?(await B(_(z),c),alert(`${R} data guru berhasil diimpor.`)):alert("Tidak ada data valid untuk diimpor. Periksa kembali file Excel Anda.")}catch(c){console.error("Gagal mengimpor file: ",c),alert("Gagal memproses file. Pastikan formatnya benar.")}finally{N(!1),t.current&&(t.current.value="")}};return x?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(K,{})}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Kelola Data Guru"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-figure text-success",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("div",{className:"stat-title",children:"Guru Aktif"}),e.jsx("div",{className:"stat-value text-success",children:j.aktif})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-figure text-error",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsx("div",{className:"stat-title",children:"Guru Nonaktif"}),e.jsx("div",{className:"stat-value text-error",children:j.nonaktif})]})]}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[e.jsx("h2",{className:"card-title text-2xl",children:"Daftar Guru"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"btn btn-primary",onClick:U,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z",clipRule:"evenodd"})}),"Tambah Guru"]}),e.jsxs("button",{className:"btn btn-info",onClick:()=>N(!0),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[e.jsx("path",{d:"M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H5.5z"}),e.jsx("path",{d:"M9 13l3-3m0 0l3 3m-3-3v8"})]}),"Impor Guru"]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsxs("div",{role:"tablist",className:"tabs tabs-boxed",children:[e.jsxs("a",{role:"tab",className:`tab ${p==="aktif"?"tab-active":""}`,onClick:()=>T("aktif"),children:["Guru Aktif (",j.aktif,")"]}),e.jsxs("a",{role:"tab",className:`tab ${p==="nonaktif"?"tab-active":""}`,onClick:()=>T("nonaktif"),children:["Guru Nonaktif (",j.nonaktif,")"]})]}),e.jsx("div",{className:"form-control w-full md:w-auto md:max-w-xs",children:e.jsx("input",{type:"text",placeholder:"Cari nama atau NIK guru...",className:"input input-bordered",value:f,onChange:a=>I(a.target.value)})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"ID Pengguna (NIK)"}),e.jsx("th",{className:"p-3",children:"Nama"}),e.jsx("th",{className:"p-3",children:"Status Kepegawaian"}),e.jsx("th",{className:"p-3",children:"Email"}),e.jsx("th",{className:"p-3",children:"Username"}),e.jsx("th",{className:"p-3",children:"Aksi"})]})}),e.jsx("tbody",{children:C.length>0?C.map(a=>e.jsxs("tr",{className:"block md:table-row mb-4 md:mb-0 p-4 md:p-0 rounded-lg shadow-md md:shadow-none bg-base-200 md:bg-transparent hover",children:[e.jsx("td",{"data-label":"NIK",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-3 border-b md:border-b-1 border-base-300 before:content-[attr(data-label)] before:text-base-content/60 before:text-left before:pr-4 before:text-sm md:before:content-none",children:a.nik}),e.jsx("td",{"data-label":"Nama",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-3 border-b md:border-b-1 border-base-300 before:content-[attr(data-label)] before:text-base-content/60 before:text-left before:pr-4 before:text-sm md:before:content-none",children:a.name}),e.jsx("td",{"data-label":"Status Kepegawaian",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-3 border-b md:border-b-1 border-base-300 before:content-[attr(data-label)] before:text-base-content/60 before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsx("span",{className:`badge ${a.employmentStatus===b.GTY?"badge-primary":"badge-secondary"}`,children:a.employmentStatus||"N/A"})}),e.jsx("td",{"data-label":"Email",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-3 border-b md:border-b-1 border-base-300 before:content-[attr(data-label)] before:text-base-content/60 before:text-left before:pr-4 before:text-sm md:before:content-none",children:a.email}),e.jsx("td",{"data-label":"Username",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-3 border-b md:border-b-1 border-base-300 before:content-[attr(data-label)] before:text-base-content/60 before:text-left before:pr-4 before:text-sm md:before:content-none",children:a.username}),e.jsx("td",{className:"flex justify-end pt-4 md:table-cell md:p-3",children:e.jsx("button",{className:"btn btn-sm btn-info w-full",onClick:()=>P(a),children:"Edit"})})]},a.id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"text-center p-4",children:["Tidak ada data guru ",p," yang ditemukan."]})})})]})}),e.jsx(D,{currentPage:v,totalPages:M,onPageChange:y})]})}),e.jsx(Q,{isOpen:G,onClose:()=>h(!1),onSave:l?L:A,formData:s,setFormData:g,selectedTeacher:l}),e.jsx(V,{isOpen:E,onClose:()=>N(!1),onImport:O,fileInputRef:t})]})};export{te as default};
