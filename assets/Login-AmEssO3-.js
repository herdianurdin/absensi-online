import{r as t,u as A,a as C,U as k,j as a,T as E,s as f,b as v,c as S,d as P,q as R,o as q,e as z,g as M}from"./index-Dae3Oafu.js";const U=()=>{const[i,j]=t.useState(""),[o,N]=t.useState(""),[g,x]=t.useState(""),[b,w]=t.useState(!1),[n,y]=t.useState(!1),d=A(),{user:c,userRole:u,loading:h}=C();t.useEffect(()=>{!h&&c&&(u===k.ADMIN?d("/admin"):u===k.GURU&&d("/guru"))},[c,u,h,d]);const L=async r=>{r.preventDefault(),x(""),w(!0);try{try{await f(v,i,o);return}catch(s){if(s.code!=="auth/invalid-credential"&&s.code!=="auth/invalid-email"&&s.code!=="auth/user-not-found")throw s}const l=S(P,"teachers"),e=R(l,q("username"),z(i.toLowerCase())),p=await M(e);if(!p.exists())throw{code:"auth/user-not-found"};let m="";if(p.forEach(s=>{m=s.val().email}),!m)throw new Error("Data guru tidak ditemukan atau tidak lengkap. Hubungi admin.");await f(v,m,o)}catch(l){let e="Terjadi kesalahan saat login.";switch(l.code){case"auth/user-not-found":e="Pengguna dengan email atau username tersebut tidak ditemukan.";break;case"auth/wrong-password":case"auth/invalid-credential":e="Password yang Anda masukkan salah.";break;case"auth/user-disabled":e="Akun ini telah dinonaktifkan.";break;case"auth/too-many-requests":e="Akses ke akun ini diblokir sementara karena terlalu banyak percobaan login. Coba lagi nanti.";break;case"auth/network-request-failed":e="Gagal terhubung ke server. Periksa koneksi internet Anda.";break;case"auth/invalid-email":e="Format email yang Anda masukkan tidak valid.";break;default:e=l.message||"Terjadi kesalahan yang tidak terduga.";break}x(e),console.error(l)}finally{w(!1)}};return h||c?a.jsx("div",{className:"flex justify-center items-center min-h-screen bg-base-200",children:a.jsx("span",{className:"loading loading-dots loading-lg"})}):a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute top-4 right-4 z-10",children:a.jsx(E,{})}),a.jsx("div",{className:"hero min-h-screen bg-base-200",children:a.jsx("div",{className:"hero-content flex-col w-full",children:a.jsx("div",{className:"card shrink-0 w-full max-w-sm shadow-2xl bg-base-100",children:a.jsxs("form",{className:"card-body",onSubmit:L,children:[a.jsx("h1",{className:"text-3xl font-bold text-center mb-4",children:"Login Sekarang!"}),a.jsxs("div",{className:"form-control",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Email atau Username"})}),a.jsx("input",{type:"text",placeholder:"email atau username",className:"input input-bordered",value:i,onChange:r=>j(r.target.value),required:!0})]}),a.jsxs("div",{className:"form-control",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Password"})}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:n?"text":"password",placeholder:"password",className:"input input-bordered w-full pr-10",value:o,onChange:r=>N(r.target.value),required:!0}),a.jsx("button",{type:"button",onClick:()=>y(!n),className:"btn btn-ghost btn-sm btn-circle absolute top-1/2 right-1 -translate-y-1/2","aria-label":n?"Sembunyikan password":"Tampilkan password",children:n?a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[a.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),a.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:[a.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z",clipRule:"evenodd"}),a.jsx("path",{d:"M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.742L2.303 6.546A10.005 10.005 0 01.458 10c1.274 4.057 5.022 7 9.542 7 1.126 0 2.206-.242 3.22-.684l-1.566-1.566z"})]})})]})]}),g&&a.jsxs("div",{role:"alert",className:"alert alert-error mt-2",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold",children:"Peringatan Login Gagal!"}),a.jsx("div",{className:"text-xs",children:g})]})]}),a.jsx("div",{className:"form-control mt-6",children:a.jsx("button",{className:"btn btn-primary",type:"submit",disabled:b,children:b?a.jsx("span",{className:"loading loading-spinner"}):"Login"})})]})})})})]})};export{U as default};
