import{j as e,R as ne,A as b,r as o}from"./index-Dae3Oafu.js";import{f as se,g as me}from"./dateHelper-gvGk2ROa.js";import{l as he}from"./teacherService-DYAXRTCH.js";import{b as be,d as te,p as xe,e as ge,r as fe,f as pe,u as le,h as je}from"./attendanceService-CRFFGP-k.js";import{g as ve}from"./settingsService-BfV9uKhR.js";import{l as ke,a as Ne}from"./calendarService-CJ4EbO9y.js";const ye=()=>e.jsxs("div",{className:"hidden md:flex items-center space-x-4 p-2",children:[e.jsx("div",{className:"h-6 w-6 bg-base-300 rounded-md"}),e.jsxs("div",{className:"flex-1 space-y-2 py-2",children:[e.jsx("div",{className:"h-4 bg-base-300 rounded w-3/5"}),e.jsx("div",{className:"h-3 bg-base-300 rounded w-2/5"})]}),e.jsx("div",{className:"h-6 w-24 bg-base-300 rounded-full"}),e.jsx("div",{className:"h-4 w-20 bg-base-300 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-base-300 rounded"}),e.jsx("div",{className:"h-6 w-28 bg-base-300 rounded"}),e.jsx("div",{className:"h-8 w-16 bg-base-300 rounded-lg"})]}),we=()=>e.jsxs("div",{className:"block md:hidden bg-base-200 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 bg-base-300 rounded w-32"}),e.jsx("div",{className:"h-3 bg-base-300 rounded w-24"})]}),e.jsx("div",{className:"h-6 w-20 bg-base-300 rounded-full"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("div",{className:"h-8 w-full bg-base-300 rounded-lg mt-2"})})]}),Se=()=>e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 animate-pulse",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-base-300 rounded w-72 mb-2"}),e.jsx("div",{className:"h-4 bg-base-300 rounded w-56"})]}),e.jsx("div",{className:"h-12 bg-base-300 rounded-lg w-full sm:w-48"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:Array.from({length:6}).map((u,r)=>e.jsx("div",{className:"h-24 bg-base-100 rounded-lg shadow-md"},r))}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsx("div",{className:"h-12 bg-base-300 rounded-lg w-full md:max-w-xs"}),e.jsx("div",{className:"h-12 bg-base-300 rounded-lg w-full md:w-80"})]}),e.jsx("div",{className:"h-12 bg-base-300 rounded-lg w-full mb-4"}),e.jsx("div",{className:"overflow-x-auto space-y-2",children:Array.from({length:5}).map((u,r)=>e.jsxs(ne.Fragment,{children:[e.jsx(ye,{}),e.jsx(we,{})]},r))})]})})]}),Oe=u=>({[b.Hadir]:"badge-success text-success-content",[b.Sakit]:"badge-warning text-warning-content",[b.Izin]:"badge-info text-info-content",[b.Dinas]:"badge-accent text-accent-content",[b.Alpa]:"badge-error text-error-content",[b.Libur]:"badge-neutral text-neutral-content",[b.TanpaKeterangan]:"badge-ghost"})[u]||"badge-ghost",Te=(u,r,t,j,n)=>{if(!u||!u.checkIn)return{late:!1,rule:""};let h;if(j&&(t!=null&&t.piketMaxCheckInTime))h=t.piketMaxCheckInTime;else if(r.employmentStatus==="GTY"&&(t!=null&&t.gtyMaxCheckInTime)){if((t==null?void 0:t.schoolDays)===5&&n===6)return{late:!1,rule:""};h=t.gtyMaxCheckInTime}if(!h)return{late:!1,rule:""};try{const c=new Date(u.checkIn),[v,y]=h.split(":").map(Number),k=new Date(c.getTime());return k.setHours(v,y,0,0),{late:c>k,rule:h}}catch(c){return console.error("Error checking late check-in:",c),{late:!1,rule:""}}},Ce=(u,r,t,j,n)=>{if(!u||!u.checkOut||u.isStayingOvernight)return{early:!1,rule:""};let h;if(j&&(t!=null&&t.piketMinCheckOutTime))h=t.piketMinCheckOutTime;else if(r.employmentStatus==="GTY"&&(t!=null&&t.gtyMinCheckOutTime)){if((t==null?void 0:t.schoolDays)===5&&n===6)return{early:!1,rule:""};h=t.gtyMinCheckOutTime}if(!h)return{early:!1,rule:""};try{const c=new Date(u.checkOut),[v,y]=h.split(":").map(Number),k=new Date(c.getTime());return k.setHours(v,y,0,0),{early:c<k,rule:h}}catch(c){return console.error("Error checking early check-out:",c),{early:!1,rule:""}}},Me=({teacher:u,todayRecord:r,holidayInfo:t,picketDuty:j,settings:n,timezone:h,dayOfWeekForToday:c,isSelected:v,onSelectForBatch:y,onOpenEditModal:k})=>{let w=(r==null?void 0:r.status)||b.TanpaKeterangan;!r&&t&&(w=b.Libur);const D=!!j[u.id],{late:s,rule:g}=Te(r,u,n,D,c),{early:p,rule:S}=Ce(r,u,n,D,c),N=D?"Piket":"GTY";return e.jsxs("tr",{className:"block md:table-row mb-4 md:mb-0 p-4 md:p-0 rounded-lg shadow-md md:shadow-none bg-base-200 md:bg-transparent hover",children:[e.jsx("td",{"data-label":"Pilih",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsxs("label",{children:[" ",e.jsx("input",{type:"checkbox",className:"checkbox",checked:v,onChange:M=>y(u.id,M.target.checked)})," "]})}),e.jsx("td",{"data-label":"Nama Guru",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold flex items-center gap-2",children:[u.name," ",D&&e.jsx("span",{className:"tooltip","data-tip":"Guru Piket",children:e.jsx("span",{className:"text-lg",children:"ðŸš©"})})]}),e.jsxs("div",{className:"text-sm opacity-50",children:[u.nik,u.employmentStatus==="GTY"&&e.jsx("span",{className:"badge badge-primary badge-xs ml-1",children:"GTY"}),u.employmentStatus==="GTT"&&e.jsx("span",{className:"badge badge-secondary badge-xs ml-1",children:"GTT"})]})]})}),e.jsx("td",{"data-label":"Status Hari Ini",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsx("span",{className:`badge ${Oe(w)}`,children:w})}),e.jsx("td",{"data-label":"Jam Masuk",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsxs("span",{className:"flex items-center gap-1 justify-end w-full",children:[r!=null&&r.checkIn?se(r.checkIn,h):"-",s&&e.jsxs("div",{className:"tooltip","data-tip":`Terlambat (${N}). Batas maks: ${g}`,children:[" ",e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-warning",viewBox:"0 0 20 20",fill:"currentColor",children:[" ",e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.1 2.142-1.1 2.778 0l5.888 10.22c.636 1.1-.114 2.431-1.389 2.431H3.758c-1.275 0-2.025-1.331-1.389-2.431l5.888-10.22zM10 13a1 1 0 100-2 1 1 0 000 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z",clipRule:"evenodd"})," "]})," "]})]})}),e.jsx("td",{"data-label":"Jam Pulang",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:e.jsxs("span",{className:"flex items-center gap-1 justify-end w-full",children:[r!=null&&r.isStayingOvernight?e.jsx("span",{className:"badge badge-info",children:"Menginap"}):r!=null&&r.checkOut?se(r.checkOut,h):"-",p&&e.jsxs("div",{className:"tooltip","data-tip":`Pulang awal (${N}). Batas min: ${S}`,children:[" ",e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-warning",viewBox:"0 0 20 20",fill:"currentColor",children:[" ",e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.1 2.142-1.1 2.778 0l5.888 10.22c.636 1.1-.114 2.431-1.389 2.431H3.758c-1.275 0-2.025-1.331-1.389-2.431l5.888-10.22zM10 13a1 1 0 100-2 1 1 0 000 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z",clipRule:"evenodd"})," "]})," "]})]})}),e.jsx("td",{"data-label":"Keterangan",className:"flex justify-between items-center text-right md:table-cell py-2 px-1 md:p-2 border-b md:border-b-0 border-base-300 before:content-[attr(data-label)] before:font-semibold before:text-left before:pr-4 before:text-sm md:before:content-none",children:(r==null?void 0:r.notes)||(w==="Libur"&&!r?t==null?void 0:t.title:"-")}),e.jsxs("td",{className:"flex justify-end pt-4 md:table-cell md:p-2",children:[" ",e.jsx("button",{className:"btn btn-sm btn-info w-full",onClick:()=>k(u),children:"Edit"})," "]})]})},De=ne.memo(Me),Ee=()=>{var ee;const[u,r]=o.useState([]),[t,j]=o.useState({}),[n,h]=o.useState(null),[c,v]=o.useState({}),[y,k]=o.useState(!0),[w,D]=o.useState("semua"),[s,g]=o.useState(""),[p,S]=o.useState(null),[N,M]=o.useState(!1),[A,E]=o.useState(!1),[F,L]=o.useState([]),[O,B]=o.useState([]),[P,q]=o.useState(""),[l,K]=o.useState(""),[U,G]=o.useState([]),[J,$]=o.useState(!1),[z,Y]=o.useState(!1),[_,W]=o.useState({}),I=(n==null?void 0:n.timezone)||"Asia/Jakarta",m=o.useMemo(()=>{if(!l)return"";const a=new Date(new Date(l).toLocaleString("en-US",{timeZone:I}));return a.setDate(a.getDate()-1),a.toISOString().split("T")[0]},[l,I]),T=o.useMemo(()=>u.filter(a=>a.status==="aktif"),[u]),Z=o.useMemo(()=>{if(l&&n){const i=new Date(l).getUTCDay();if(i===0||n.schoolDays===5&&i===6)return!0}return!1},[l,n]),Q=o.useMemo(()=>{const a=c[l];return a&&Object.values(a).find(d=>d.type==="Libur")||null},[c,l]),H=o.useMemo(()=>Z?{title:"Libur Akhir Pekan",type:"Libur"}:Q,[Z,Q]),V=o.useCallback(a=>{var d;const i=(d=t[a])==null?void 0:d[l];return!i||i.status===b.TanpaKeterangan?H?"libur":"belum-hadir":i.status===b.Hadir||i.status===b.Dinas?"hadir":i.status===b.Libur?"libur":"tidak-hadir"},[t,l,H]),X=o.useMemo(()=>l?T.filter(a=>{const i=V(a.id);return w==="semua"||w===i}).filter(a=>a.name.toLowerCase().includes(s.toLowerCase())||a.nik&&a.nik.includes(s)):[],[T,V,w,s,l]),ie=o.useMemo(()=>{const a={total:T.length,hadir:0,dinas:0,"belum-hadir":0,"tidak-hadir":0,menginap:0,libur:0};return l&&T.forEach(i=>{var f;const d=(f=t[i.id])==null?void 0:f[l];if(d!=null&&d.isStayingOvernight&&a.menginap++,!d&&H){a.libur++;return}switch(d==null?void 0:d.status){case b.Hadir:a.hadir++;break;case b.Dinas:a.dinas++;break;case b.Izin:case b.Sakit:case b.Alpa:a["tidak-hadir"]++;break;case b.Libur:a.libur++;break;default:a["belum-hadir"]++;break}}),a},[T,t,l,H]),re=o.useMemo(()=>l?new Date(l).getUTCDay():-1,[l]),ce=p?(ee=t[p.id])==null?void 0:ee[l]:null;o.useEffect(()=>{const a=()=>{const x=me(I);l!==x&&K(x)};a();const i=setInterval(a,5*60*1e3),d=()=>{document.visibilityState==="visible"&&a()};return document.addEventListener("visibilitychange",d),()=>{clearInterval(i),document.removeEventListener("visibilitychange",d)}},[I,l]),o.useEffect(()=>{Y(!1)},[l]),o.useEffect(()=>{if(!l)return;k(!0),(async()=>{try{const C=await ve();h(C)}catch(C){console.error("Failed to fetch settings: ",C)}})();const i=he(C=>{r(C),y&&k(!1)}),d=be(l,L),x=ke(v),f=Ne(l,C=>{W(C||{})});return()=>{i(),d(),x(),f()}},[l]),o.useEffect(()=>{if(!l)return;const a=te(l,i=>{j(d=>{const x={...d};return Object.keys(i).forEach(f=>{x[f]||(x[f]={}),x[f][l]=i[f]}),Object.keys(d).forEach(f=>{var C;(C=d[f])!=null&&C[l]&&!i[f]&&delete x[f][l]}),x})});return()=>a()},[l]),o.useEffect(()=>{if(!m)return;const a=te(m,i=>{j(d=>{const x={...d};return Object.keys(i).forEach(f=>{x[f]||(x[f]={}),x[f][m]=i[f]}),Object.keys(d).forEach(f=>{var C;(C=d[f])!=null&&C[m]&&!i[f]&&delete x[f][m]}),x})});return()=>a()},[m]),o.useEffect(()=>{!l||Object.keys(t).length===0||u.length===0||xe(T,t,l).catch(a=>console.error("Failed to process overnight stays:",a))},[T,t,l]),o.useEffect(()=>{var i;if(!m||Object.keys(t).length===0||u.length===0){G([]);return}const a=[];for(const d of T){const x=(i=t[d.id])==null?void 0:i[m];x&&x.checkIn&&!x.checkOut&&!x.isStayingOvernight&&a.push(d)}G(a)},[t,T,m]),o.useEffect(()=>{if(!H||T.length===0||!l||z)return;const i=setTimeout(async()=>{const d=T.filter(x=>{var f;return!((f=t[x.id])!=null&&f[l])});if(d.length>0){const x=d.map(f=>f.id);try{await ge(x,l,H.title),Y(!0)}catch(f){console.error("Failed to set holiday attendance records:",f)}}else Y(!0)},1500);return()=>clearTimeout(i)},[H,T,t,l,z]);const de=o.useCallback(a=>{S(a),M(!0)},[]),R=()=>{S(null),M(!1)},oe=async a=>{if(!p||!l)return;const i={status:a.status,notes:a.notes||"",entryMethod:"admin",isStayingOvernight:a.isStayingOvernight},d=x=>{if(!x)return null;const[f,C]=x.split(":"),ae=new Date(new Date(l).toLocaleString("en-US",{timeZone:I}));return ae.setHours(parseInt(f,10),parseInt(C,10),0,0),ae.toISOString()};a.status===b.Hadir?(i.checkIn=d(a.checkInTime),i.checkOut=a.isStayingOvernight?null:d(a.checkOutTime)):(i.checkIn=null,i.checkOut=null);try{await le(p.id,l,i,p.name),R()}catch(x){console.error("Failed to update attendance:",x),alert("Gagal menyimpan perubahan.")}},ue=o.useCallback((a,i)=>{B(d=>i?[...d,a]:d.filter(x=>x!==a))},[]);return{isLoadingInitial:y,todayStr:l,yesterdayStr:m,timezone:I,stats:ie,holidayInfo:H,pendingRequests:F,incompleteYesterday:U,filter:w,setFilter:D,searchQuery:s,setSearchQuery:g,batchStatus:P,setBatchStatus:q,filteredTeachers:X,selectedForBatch:O,handleSelectForBatch:ue,handleSelectAllForBatch:a=>{B(a?X.map(i=>i.id):[])},handleApplyBatchUpdate:async()=>{if(O.length===0||!P){alert("Pilih setidaknya satu guru dan satu status untuk diterapkan.");return}if(window.confirm(`Anda akan mengubah status ${O.length} guru menjadi "${P}". Lanjutkan?`))try{await je(O,l,P),B([]),q("")}catch(a){console.error("Gagal melakukan batch update:",a),alert("Gagal melakukan perubahan massal.")}},isEditModalOpen:N,isRequestModalOpen:A,setIsRequestModalOpen:E,isFixYesterdayModalOpen:J,setIsFixYesterdayModalOpen:$,selectedTeacher:p,todayRecordForModal:ce,handleOpenEditModal:de,handleCloseEditModal:R,handleSaveChanges:oe,handleApproveRequest:async a=>{var i;try{const d=((i=t[a.teacherId])==null?void 0:i[l])||null;await pe(a,d)}catch(d){console.error("Failed to approve request:",d),alert("Gagal menyetujui permintaan.")}},handleRejectRequest:async a=>{try{await fe(a)}catch(i){console.error("Failed to reject request:",i),alert("Gagal menolak permintaan.")}},handleFixYesterdaySuccess:a=>{G(i=>i.filter(d=>d.id!==a))},attendance:t,picketDuty:_,settings:n,dayOfWeekForToday:re}},Ie=({isOpen:u,onClose:r,onSave:t,teacher:j,todayRecord:n,timezone:h})=>{const[c,v]=o.useState({status:b.TanpaKeterangan,checkInTime:"",checkOutTime:"",notes:"",isStayingOvernight:!1}),y=s=>{if(!s)return"";try{return new Date(s).toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",timeZone:h})}catch{return""}};if(o.useEffect(()=>{u&&j&&v({status:(n==null?void 0:n.status)||b.TanpaKeterangan,checkInTime:y(n==null?void 0:n.checkIn),checkOutTime:y(n==null?void 0:n.checkOut),notes:(n==null?void 0:n.notes)||"",isStayingOvernight:(n==null?void 0:n.isStayingOvernight)||!1})},[u,j,n,h]),o.useEffect(()=>{c.status!==b.Hadir&&v(s=>({...s,checkInTime:"",checkOutTime:""})),c.isStayingOvernight&&v(s=>({...s,checkOutTime:""}))},[c.status,c.isStayingOvernight]),!u||!j)return null;const k=s=>{s.preventDefault(),t(c)},w=s=>{const g=s.target.value;v(p=>({...p,status:g,isStayingOvernight:g===b.Hadir?p.isStayingOvernight:!1}))},D=Object.values(b);return e.jsxs("dialog",{id:"edit_attendance_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Edit Absensi untuk ",j.name]}),e.jsxs("p",{children:["Tanggal: ",new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Status Kehadiran"})}),e.jsx("select",{className:"select select-bordered w-full",value:c.status,onChange:w,children:D.map(s=>e.jsx("option",{value:s,children:s},s))})]}),c.status===b.Hadir&&e.jsxs("div",{className:"p-4 border border-base-300 rounded-lg space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Atur Waktu Kehadiran"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jam Masuk"})}),e.jsx("input",{type:"time",className:"input input-bordered w-full",value:c.checkInTime,onChange:s=>v(g=>({...g,checkInTime:s.target.value}))})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jam Pulang"})}),e.jsx("input",{type:"time",className:"input input-bordered w-full",value:c.checkOutTime,onChange:s=>v(g=>({...g,checkOutTime:s.target.value})),disabled:c.isStayingOvernight})]})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer",children:[e.jsx("span",{className:"label-text",children:"Menginap (Tidak Absen Pulang)"}),e.jsx("input",{type:"checkbox",checked:c.isStayingOvernight,onChange:s=>v(g=>({...g,isStayingOvernight:s.target.checked})),className:"toggle toggle-primary"})]})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Catatan (Opsional)"})}),e.jsx("textarea",{className:"textarea textarea-bordered",placeholder:"Contoh: Mengikuti rapat dinas di Disdik",value:c.notes,onChange:s=>v(g=>({...g,notes:s.target.value}))})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:r,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Simpan Perubahan"})]})]})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:r,children:"close"})})]})},Ae=({isOpen:u,onClose:r,requests:t,onApprove:j,onReject:n})=>u?e.jsxs("dialog",{id:"pending_requests_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box w-11/12 max-w-3xl",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Tinjau Pengajuan Absensi"}),e.jsx("p",{className:"py-2",children:"Setujui atau tolak pengajuan status kehadiran dari guru."}),e.jsx("div",{className:"divider my-2"}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:t.length>0?t.map(h=>e.jsx("div",{className:"card bg-base-200",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:h.teacherName}),e.jsxs("p",{className:"text-sm",children:["Status Diajukan: ",e.jsxs("span",{className:"font-semibold",children:[h.requestedStatus," ",h.isStayingOvernight?"(Menginap)":""]})]})]}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(h.requestTimestamp).toLocaleString("id-ID")})]}),e.jsxs("p",{className:"mt-2 p-2 bg-base-100 rounded-md text-sm",children:[e.jsx("span",{className:"font-semibold",children:"Catatan:"})," ",h.notes]}),e.jsxs("div",{className:"card-actions justify-end mt-2",children:[e.jsx("button",{className:"btn btn-sm btn-error",onClick:()=>n(h),children:"Tolak"}),e.jsx("button",{className:"btn btn-sm btn-success",onClick:()=>j(h),children:"Setujui"})]})]})},h.teacherId)):e.jsx("p",{className:"text-center p-4",children:"Tidak ada pengajuan yang perlu ditinjau saat ini."})}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn",onClick:r,children:"Tutup"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:r,children:"close"})})]}):null,He=({isOpen:u,onClose:r,teachersToFix:t,yesterdayStr:j,timezone:n,onSaveSuccess:h})=>{const[c,v]=o.useState({}),[y,k]=o.useState(null);o.useEffect(()=>{if(u){const s={};t.forEach(g=>{s[g.id]={checkOutTime:"",status:b.Hadir,isStayingOvernight:!1}}),v(s)}},[u,t]);const w=(s,g,p)=>{v(S=>({...S,[s]:{...S[s],[g]:p}}))},D=async s=>{k(s);const g=c[s];if(!g){alert("Data tidak ditemukan."),k(null);return}const p={status:g.status,isStayingOvernight:g.isStayingOvernight,notes:g.status!==b.Hadir?"Status diubah oleh admin pada hari berikutnya.":g.isStayingOvernight?"Status menginap diatur oleh admin pada hari berikutnya.":"Jam pulang diisi oleh admin pada hari berikutnya."},S=N=>{if(!N)return null;const[M,A]=N.split(":"),E=new Date(new Date(j).toLocaleString("en-US",{timeZone:n}));return E.setHours(parseInt(M,10),parseInt(A,10),0,0),E.toISOString()};g.status===b.Hadir&&!g.isStayingOvernight?p.checkOut=S(g.checkOutTime):p.checkOut=null;try{const N=t.find(M=>M.id===s);await le(s,j,p,N==null?void 0:N.name),h(s)}catch(N){console.error("Failed to update yesterday's attendance:",N),alert("Gagal menyimpan data untuk guru ini.")}finally{k(null)}};return u?e.jsxs("dialog",{id:"fix_yesterday_modal",className:"modal modal-open",children:[e.jsxs("div",{className:"modal-box w-11/12 max-w-4xl",children:[e.jsxs("h3",{className:"font-bold text-lg",children:["Perbaiki Absensi Kemarin (",new Date(j).toLocaleDateString("id-ID"),")"]}),e.jsx("p",{className:"py-2",children:"Beberapa guru terdeteksi belum melakukan absen pulang kemarin. Silakan isi jam pulang atau ubah status mereka."}),e.jsx("div",{className:"divider my-2"}),e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:t.length>0?t.map(s=>{var g,p,S,N,M,A,E,F,L;return e.jsx("div",{className:"card bg-base-200",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("p",{className:"font-bold",children:[s.name," ",e.jsxs("span",{className:"font-normal opacity-70",children:["(",s.nik,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4 mt-2 items-end",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Status Kemarin"})}),e.jsx("select",{className:"select select-bordered",value:((g=c[s.id])==null?void 0:g.status)||"",onChange:O=>w(s.id,"status",O.target.value),children:Object.values(b).map(O=>e.jsx("option",{value:O,children:O},O))})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jam Pulang"})}),e.jsx("input",{type:"time",className:"input input-bordered",value:((p=c[s.id])==null?void 0:p.checkOutTime)||"",onChange:O=>w(s.id,"checkOutTime",O.target.value),disabled:((S=c[s.id])==null?void 0:S.status)!==b.Hadir||((N=c[s.id])==null?void 0:N.isStayingOvernight)})]}),e.jsx("div",{className:"form-control self-center pt-8",children:e.jsxs("label",{className:"label cursor-pointer",children:[e.jsx("span",{className:"label-text",children:"Menginap?"}),e.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:((M=c[s.id])==null?void 0:M.isStayingOvernight)||!1,onChange:O=>w(s.id,"isStayingOvernight",O.target.checked),disabled:((A=c[s.id])==null?void 0:A.status)!==b.Hadir})]})}),e.jsx("div",{className:"flex",children:e.jsx("button",{className:"btn btn-primary w-full",onClick:()=>D(s.id),disabled:y===s.id||((E=c[s.id])==null?void 0:E.status)===b.Hadir&&!((F=c[s.id])!=null&&F.checkOutTime)&&!((L=c[s.id])!=null&&L.isStayingOvernight),children:y===s.id?e.jsx("span",{className:"loading loading-spinner"}):"Simpan"})})]})]})},s.id)}):e.jsx("p",{className:"text-center p-4",children:"Semua absensi kemarin sudah lengkap."})}),e.jsx("div",{className:"modal-action",children:e.jsx("button",{className:"btn btn-neutral",onClick:r,children:"Selesai & Tutup"})})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{onClick:r,children:"close"})})]}):null},$e=()=>{const{isLoadingInitial:u,todayStr:r,yesterdayStr:t,timezone:j,stats:n,holidayInfo:h,pendingRequests:c,incompleteYesterday:v,filter:y,setFilter:k,searchQuery:w,setSearchQuery:D,batchStatus:s,setBatchStatus:g,filteredTeachers:p,selectedForBatch:S,handleSelectForBatch:N,handleSelectAllForBatch:M,handleApplyBatchUpdate:A,isEditModalOpen:E,isRequestModalOpen:F,setIsRequestModalOpen:L,isFixYesterdayModalOpen:O,setIsFixYesterdayModalOpen:B,selectedTeacher:P,todayRecordForModal:q,handleOpenEditModal:l,handleCloseEditModal:K,handleSaveChanges:U,handleApproveRequest:G,handleRejectRequest:J,handleFixYesterdaySuccess:$,attendance:z,picketDuty:Y,settings:_,dayOfWeekForToday:W}=Ee();if(u||!r)return e.jsx(Se,{});const I=[{value:"semua",label:"Semua",count:n.total},{value:"hadir",label:"Hadir",count:n.hadir+n.dinas},{value:"belum-hadir",label:"Belum Absen",count:n["belum-hadir"]},{value:"tidak-hadir",label:"Tidak Hadir",count:n["tidak-hadir"]},{value:"libur",label:"Libur",count:n.libur}];return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Status Absensi Hari Ini"}),e.jsx("p",{className:"text-base-content/70 mt-1",children:new Date(r).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric",timeZone:"UTC"})})]}),e.jsxs("button",{className:"btn btn-info w-full sm:w-auto",onClick:()=>L(!0),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15v1a1 1 0 001 1h12a1 1 0 001-1v-1a1 1 0 00-.293-.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),"Tinjau Pengajuan",c.length>0&&e.jsx("span",{className:"badge badge-error",children:c.length})]})]}),h&&e.jsxs("div",{role:"alert",className:"alert alert-info mb-6 shadow-md",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Hari Libur"}),e.jsxs("div",{className:"text-sm",children:["Hari ini adalah hari libur: ",e.jsx("strong",{children:h.title}),". Guru tidak diwajibkan melakukan absensi."]})]})]}),v.length>0&&e.jsxs("div",{role:"alert",className:"alert alert-warning mb-6 shadow-md",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Perhatian!"}),e.jsxs("div",{className:"text-sm",children:["Ditemukan ",v.length," guru yang belum absen pulang kemarin."]})]}),e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>B(!0),children:"Lihat & Perbaiki"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Hadir"}),e.jsx("div",{className:"stat-value text-success",children:n.hadir})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Dinas"}),e.jsx("div",{className:"stat-value text-accent",children:n.dinas})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Belum Absen"}),e.jsx("div",{className:"stat-value text-warning",children:n["belum-hadir"]})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Tidak Hadir"}),e.jsx("div",{className:"stat-value text-error",children:n["tidak-hadir"]})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Libur"}),e.jsx("div",{className:"stat-value",children:n.libur})]}),e.jsxs("div",{className:"stat bg-base-100 rounded-lg shadow",children:[e.jsx("div",{className:"stat-title",children:"Menginap"}),e.jsx("div",{className:"stat-value text-info",children:n.menginap})]})]}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4 gap-4",children:[e.jsx("input",{type:"text",placeholder:"Cari nama atau NIK guru...",className:"input input-bordered w-full md:max-w-xs",value:w,onChange:m=>D(m.target.value)}),e.jsxs("div",{className:"join w-full md:w-auto",children:[e.jsxs("select",{className:"select select-bordered join-item w-full",value:s,onChange:m=>g(m.target.value),children:[e.jsx("option",{value:"",children:"Pilih Status Massal"}),Object.values(b).map(m=>e.jsx("option",{value:m,children:m},m))]}),e.jsx("button",{className:"btn btn-primary join-item",onClick:A,disabled:S.length===0||!s,children:"Terapkan"})]})]}),e.jsx("div",{role:"tablist",className:"tabs tabs-boxed mb-4 hidden md:flex",children:I.map(m=>e.jsxs("a",{role:"tab",className:`tab ${y===m.value?"tab-active":""}`,onClick:()=>k(m.value),children:[" ",m.label," (",m.count,") "]},m.value))}),e.jsx("div",{className:"form-control w-full md:hidden mb-4",children:e.jsx("select",{className:"select select-bordered",value:y,onChange:m=>k(m.target.value),children:I.map(m=>e.jsxs("option",{value:m.value,children:[m.label," (",m.count,")"]},m.value))})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table w-full",children:[e.jsx("thead",{className:"hidden md:table-header-group",children:e.jsxs("tr",{children:[e.jsxs("th",{children:[" ",e.jsxs("label",{children:[" ",e.jsx("input",{type:"checkbox",className:"checkbox",onChange:m=>M(m.target.checked),checked:p.length>0&&S.length===p.length})," "]})," "]}),e.jsx("th",{children:"Nama Guru"}),e.jsx("th",{children:"Status Hari Ini"}),e.jsx("th",{children:"Jam Masuk"}),e.jsx("th",{children:"Jam Pulang"}),e.jsx("th",{children:"Keterangan"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:p.length>0?p.map(m=>{var T;return e.jsx(De,{teacher:m,todayRecord:(T=z[m.id])==null?void 0:T[r],holidayInfo:h,picketDuty:Y,settings:_,timezone:j,dayOfWeekForToday:W,isSelected:S.includes(m.id),onSelectForBatch:N,onOpenEditModal:l},m.id)}):e.jsxs("tr",{children:[" ",e.jsx("td",{colSpan:7,className:"text-center p-4",children:" Tidak ada data guru yang cocok dengan filter. "})," "]})})]})})]})}),e.jsx(Ie,{isOpen:E,onClose:K,onSave:U,teacher:P,todayRecord:q,timezone:j}),e.jsx(Ae,{isOpen:F,onClose:()=>L(!1),requests:c,onApprove:G,onReject:J}),e.jsx(He,{isOpen:O,onClose:()=>B(!1),teachersToFix:v,yesterdayStr:t,timezone:j,onSaveSuccess:$})]})};export{$e as default};
